# Faire des graphiques avec `ggplot2`

## Tâches concernées et recommandations

L'utilisateur souhaite réaliser des graphiques avec `R` (nuages de points, histogrammes, densité...).


::: {.recommandation data-latex=""}

* Il est recommandé d'utiliser le *package* `ggplot2` qui permet de réaliser et de personnaliser un grand nombre de représentations graphiques;
* Il est conseillé aux utilisateurs débutants d'utiliser l'*add-in* `esquisse` pour se familiariser avec `ggplot2`.
:::


## Plan temporaire de la fiche

Source1: https://juba.github.io/tidyverse/08-ggplot2.html
Source2: https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html

### Introduction aux graphiques en `R` (éventuellement sous la forme d'une petite fiche détachable)

#### L'add-in esquisse

Reprendre le 8.9 de source1.

#### Eventuellement: `ggformula`

## Début de la fiche `ggplot2`

### Les éléments clés d'un ggplot

Reprendre le 4.3 de source2.

### Bien détailler le mapping (c'est le plus compliqué en ggplot)

Reprendre le 5 de source2 (sans l'exercice). Bien expliquer la différence entre ce qui est dans `aes()` et en-dehors.

### Présenter quelques geometries

Reprendre le 8.3 de source1 et/ou le 6 de source2.

### Les options des graphiques

Titre, légendes, axes, scales, xlim/ylim.

Reprendre le 7 et le 9 de source2.

### Exporter un graphique

Reprendre le 12 de source2.

### Sources (ne pas oublier de nommer les auteurs)

Source1: https://juba.github.io/tidyverse/08-ggplot2.html
Source2: https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html









## Quelques détails sur comment réaliser la tâche avec les outils recommandés

::: {.conseil data-latex=""}
**Conseil**

Cette boîte colorée sert à donner un conseil. Son usage n'est évidemment pas obligatoire.

:::

::: {.remarque data-latex=""}
**Remarque**

Cette boîte colorée sert à faire une remarque. Son usage n'est évidemment pas obligatoire.

:::

### Réaliser la tâche, cas 1

Lorsqu'on est débutant, il faut utiliser la fonction `super_fonction()` du *package* `super_package`.

La fonction `super_fonction()` fonctionne comme ceci par défaut: blabla.

La fonction `super_fonction()` propose beaucoup d'options:

* `option1`: blabla;
* `option2`: blabla;
* `option3`: blabla.

Voici un premier exemple de code (le plus simple possible, en utilisant des données facilement disponibles sur le site de l'Insee):

```{r, eval = FALSE}
library(super_package)
output <- super_fonction(arguments)
```

Ne pas oublier d'expliquer ce qu'on obtient comme output.

Voici un second exemple de code, avec des options un peu plus avancées:

```{r, eval = FALSE}
output <- super_fonction(arguments et options)
```


### Réaliser la tâche, cas 2

Lorsqu'on est plus avancé, on peut utiliser la fonction `hyper_fonction()` du *package* `hyper_package`.

* Comportement par défaut;
* Principales options;
* Exemples de code.

## Quelques bonnes pratiques

Quelques conseils généraux sur la façon de s'y prendre.

* Faut-il préprocesser les données avant de réaliser la tâche;
* Comment minimiser les temps de calculs/la charge en RAM.

## Sources

Cette fiche reprend et adapte des éléments issus des source suivantes:

- [Partie `ggplot2`](https://juba.github.io/tidyverse/08-ggplot2.html) de l'introduction à `R` et au `tidyverse`;
- [Partie `ggplot2`](https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html) de la formation à `R` du Ministère de la Transition écologique et solidaire.


## Références


* [La documentation officielle](http://ggplot2.tidyverse.org/index.html) (en anglais) de `ggplot2` est très complète et accessible en ligne.
* Une "antisèche" (en anglais) résumant en deux pages l'ensemble des fonctions et arguments et disponible soit directement depuis RStudio (menu *Help > Cheatsheets > Data visualization with ggplot2*) ou [en ligne](https://www.rstudio.com/resources/cheatsheets/).
* Les parties [Data visualisation](http://r4ds.had.co.nz/data-visualisation.html) et [Graphics for communication](http://r4ds.had.co.nz/graphics-for-communication.html) de l'ouvrage en ligne *R for data science*, de Hadley Wickham, sont une très bonne introduction à `ggplot2`.
* Plusieurs ouvrages, toujours en anglais, abordent en détail l'utilisation de `ggplot2`:
    - [ggplot2: Elegant Graphics for Data Analysis](http://www.amazon.fr/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403/) de Hadley Wickham;
    - [R Graphics Cookbook](http://www.amazon.fr/R-Graphics-Cookbook-Winston-Chang/dp/1449316956) de Winston Chang. Le [site associé](http://www.cookbook-r.com/Graphs/) à ce dernier ouvrage comporte aussi pas mal d'exemples et d'informations intéressantes.

Enfin, si `ggplot2` présente déjà un très grand nombre de fonctionnalités, il existe aussi un système d'extensions permettant d'ajouter des `geom`, des thèmes, etc. Le site [ggplot2 extensions](http://www.ggplot2-exts.org/) est une très bonne ressource pour les parcourir et les découvrir, notamment grâce à sa [galerie](http://www.ggplot2-exts.org/gallery/).

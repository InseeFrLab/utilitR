<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>16&nbsp; Travailler avec des API</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../03_Fiches_thematiques/Fiche_connexion_bdd.html" rel="next">
<link href="../03_Fiches_thematiques/Fiche_import_fichiers_parquet.html" rel="prev">
<link href="../resources/logo-utilitr.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-24e348eb49483fd7b2175c657ae88dd5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-6806d1676b818f69bfdf2f80fe791bd2.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><script src="../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../resources/logo-utilitr.png" alt="Logo du projet utilitR" class="navbar-logo"></a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../01_R_Insee/presentation_utilitr.html" aria-current="page"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../03_Fiches_thematiques/Fiche_rprojects.html"> 
<span class="menu-text">Mener un projet statistique</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../03_Fiches_thematiques/Fiche_import_fichiers_plats.html"> 
<span class="menu-text">Importer des données</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../03_Fiches_thematiques/Fiche_tidyverse.html"> 
<span class="menu-text">Choisir son paradigme</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../03_Fiches_thematiques/Fiche_joindre_donnees.html"> 
<span class="menu-text">Manipuler des données</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../03_Fiches_thematiques/Fiche_graphiques.html"> 
<span class="menu-text">Produire des sorties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../02_Bonnes_pratiques/01-qualite-code.html"> 
<span class="menu-text">Bonnes pratiques</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/InseeFrLab/utilitR" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03_Fiches_thematiques/Fiche_import_fichiers_plats.html">Importer des données avec R</a></li><li class="breadcrumb-item"><a href="../03_Fiches_thematiques/Fiche_api.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Travailler avec des API</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../resources/logo-utilitr.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><span class="bigger120"><code>utilitR</code> ne couvre pas tous les besoin, loin s’en faut!</span></span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/presentation_utilitr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Présentation du projet <code>utilitR</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/Fiche_utiliser_utilitR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Comment utiliser la documentation <code>utilitR</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Mener un projet statistique avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_rprojects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Utiliser les projets <code>RStudio</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_git_utilisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Utiliser <code>Git</code> avec RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/Fiche_installer_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Utiliser des <em>packages</em> <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_comment_choisir_un_package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Comment choisir un <em>package</em> ?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_gerer_dependances.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Gérer les dépendances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_se_documenter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Se documenter sur <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_resoudre_un_probleme.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Résoudre un problème avec <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_targets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Construire une chaîne de traitement reproductible avec <code>targets</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Importer des données avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_import_fichiers_plats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Importer des fichiers plats (<code>.csv</code>, <code>.tsv</code>, <code>.txt</code>)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_import_tables_sas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Importer des tables SAS®</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_import_tableurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Importer des fichiers issus de tableurs (Excel, Calc)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_import_fichiers_parquet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Lire et écrire des fichiers Parquet</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_api.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Travailler avec des API</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_connexion_bdd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Se connecter à une base de données</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Choisir son paradigme d’analyse des données avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Manipuler des données avec le <code>tidyverse</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_datatable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Manipuler des données avec <code>data.table</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Manipuler des données avec <code>arrow</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_duckdb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Manipuler des données avec <code>duckdb</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Manipuler des données avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_joindre_donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Joindre des tables de données</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_donnees_textuelles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Manipuler des données textuelles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Utiliser des données d’enquêtes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_donnees_spatiales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Manipuler des données spatiales</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_donnees_temporelles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Manipuler des données temporelles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_analyse_de_donnees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">L’analyse de données (ACP, ACM, ACF…)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Produire des sorties avec R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_graphiques.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Faire des graphiques avec <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Produire des documents avec <code>R Markdown</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_rmarkdown_param_report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Produire des rapports automatisés avec <code>R Markdown</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Bonnes pratiques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_Bonnes_pratiques/01-qualite-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Qualité du code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_Bonnes_pratiques/02-structure-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Structure des projets</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Éléments de configuration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/Fiche_utiliser_Rstudio_AUSv3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Utiliser RStudio sur l’environnement AUSv3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03_Fiches_thematiques/Fiche_configurer_git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Configurer <code>Git</code> sur son poste de travail</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/Fiche-personnaliser-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Personnaliser la configuration de <code>R</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_R_Insee/Fiche_utiliser_ressources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Superviser sa session <code>R</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#rappels-des-notions-essentielles-sur-les-api" id="toc-rappels-des-notions-essentielles-sur-les-api" class="nav-link active" data-scroll-target="#rappels-des-notions-essentielles-sur-les-api"><span class="header-section-number">16.1</span> Rappels des notions essentielles sur les API</a>
  <ul class="collapse">
<li><a href="#quest-ce-quune-api" id="toc-quest-ce-quune-api" class="nav-link" data-scroll-target="#quest-ce-quune-api"><span class="header-section-number">16.1.1</span> Qu’est-ce qu’une API ?</a></li>
  <li><a href="#avantages-des-api" id="toc-avantages-des-api" class="nav-link" data-scroll-target="#avantages-des-api"><span class="header-section-number">16.1.2</span> Avantages des API</a></li>
  <li><a href="#utilisation-des-api" id="toc-utilisation-des-api" class="nav-link" data-scroll-target="#utilisation-des-api"><span class="header-section-number">16.1.3</span> Utilisation des API</a></li>
  </ul>
</li>
  <li>
<a href="#quelques-packages-permettant-une-utilisation-simple-des-api-des-donn%C3%A9es-insee" id="toc-quelques-packages-permettant-une-utilisation-simple-des-api-des-données-insee" class="nav-link" data-scroll-target="#quelques-packages-permettant-une-utilisation-simple-des-api-des-donn%C3%A9es-insee"><span class="header-section-number">16.2</span> Quelques <em>packages</em> permettant une utilisation simple des API des données Insee</a>
  <ul class="collapse">
<li><a href="#le-package-apinsee" id="toc-le-package-apinsee" class="nav-link" data-scroll-target="#le-package-apinsee"><span class="header-section-number">16.2.1</span> Le <em>package</em> apinsee</a></li>
  <li><a href="#le-package-doremifasol" id="toc-le-package-doremifasol" class="nav-link" data-scroll-target="#le-package-doremifasol"><span class="header-section-number">16.2.2</span> Le <em>package</em> doremifasol</a></li>
  <li><a href="#le-package-inseelocaldata" id="toc-le-package-inseelocaldata" class="nav-link" data-scroll-target="#le-package-inseelocaldata"><span class="header-section-number">16.2.3</span> Le <em>package</em> inseeLocalData</a></li>
  <li><a href="#le-package-insee" id="toc-le-package-insee" class="nav-link" data-scroll-target="#le-package-insee"><span class="header-section-number">16.2.4</span> Le <em>package</em> insee</a></li>
  <li><a href="#le-package-oecd" id="toc-le-package-oecd" class="nav-link" data-scroll-target="#le-package-oecd"><span class="header-section-number">16.2.5</span> Le <em>package</em> OECD</a></li>
  </ul>
</li>
  <li>
<a href="#exemple-dutilisation-dune-api-sans-package" id="toc-exemple-dutilisation-dune-api-sans-package" class="nav-link" data-scroll-target="#exemple-dutilisation-dune-api-sans-package"><span class="header-section-number">16.3</span> Exemple d’utilisation d’une API sans <em>package</em></a>
  <ul class="collapse">
<li><a href="#le-package-httr" id="toc-le-package-httr" class="nav-link" data-scroll-target="#le-package-httr"><span class="header-section-number">16.3.1</span> Le <em>package</em> <code>httr</code></a></li>
  <li><a href="#acc%C3%A8s-%C3%A0-une-api-sans-jeton" id="toc-accès-à-une-api-sans-jeton" class="nav-link" data-scroll-target="#acc%C3%A8s-%C3%A0-une-api-sans-jeton"><span class="header-section-number">16.3.2</span> Accès à une API sans jeton</a></li>
  <li><a href="#acc%C3%A8s-%C3%A0-une-api-avec-jeton" id="toc-accès-à-une-api-avec-jeton" class="nav-link" data-scroll-target="#acc%C3%A8s-%C3%A0-une-api-avec-jeton"><span class="header-section-number">16.3.3</span> Accès à une API avec jeton</a></li>
  <li><a href="#le-package-jsonlite" id="toc-le-package-jsonlite" class="nav-link" data-scroll-target="#le-package-jsonlite"><span class="header-section-number">16.3.4</span> Le <em>package</em> <code>jsonlite</code></a></li>
  <li><a href="#temporisation" id="toc-temporisation" class="nav-link" data-scroll-target="#temporisation"><span class="header-section-number">16.3.5</span> Temporisation</a></li>
  <li><a href="#exemple-dutilisation-de-lapi-sirene" id="toc-exemple-dutilisation-de-lapi-sirene" class="nav-link" data-scroll-target="#exemple-dutilisation-de-lapi-sirene"><span class="header-section-number">16.3.6</span> Exemple d’utilisation de l’API Sirene</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/InseeFrLab/utilitR/edit/master/03_Fiches_thematiques/Fiche_api.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/InseeFrLab/utilitR/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03_Fiches_thematiques/Fiche_import_fichiers_plats.html">Importer des données avec R</a></li><li class="breadcrumb-item"><a href="../03_Fiches_thematiques/Fiche_api.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Travailler avec des API</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="api" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Travailler avec des API</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>L’utilisateur souhaite accéder à des données <em>via</em> une API.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tâche concernée et recommandation
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>En premier lieu, il est recommandé de vérifier s’il existe un <em>package</em> <code>R</code> spécifique à l’API que vous voulez utiliser.</li>
<li>S’il n’existe de <em>package</em> spécifique,il est recommandé d’utiliser le <em>package</em> <code>httr</code> pour transmettre des requêtes à l’API et le <em>package</em> <code>jsonlite</code> pour retravailler le résultat des requêtes afin de la transformer dans un format plus exploitable.</li>
<li>Pour accéder à des données disponibles sur le site <a href="https://www.insee.fr" class="uri">https://www.insee.fr</a>, il est recommandé d’utiliser l’un des <em>packages</em> suivants : <code>doremifasol</code>, <code>insee</code>, <code>inseeLocalData</code>. Le <em>package</em> <code>apinsee</code> permet de gérer le renouvellement des jetons de connexion.</li>
<li>Les jetons d’accès (<em>token</em>) doivent être utilisés sous forme de variable d’environnements, inscrits dans un fichier <code>.Renviron</code> qui n’est pas partagé.</li>
<li>Si l’accès à internet se fait par l’intermédiaire d’un proxy, sous Windows, il est recommandé d’utiliser la fonction <code><a href="https://jeroen.r-universe.dev/curl/reference/ie_proxy.html">curl::ie_get_proxy_for_url</a></code>.</li>
</ul>
</div>
</div>
<section id="rappels-des-notions-essentielles-sur-les-api" class="level2" data-number="16.1"><h2 data-number="16.1" class="anchored" data-anchor-id="rappels-des-notions-essentielles-sur-les-api">
<span class="header-section-number">16.1</span> Rappels des notions essentielles sur les API</h2>
<section id="quest-ce-quune-api" class="level3" data-number="16.1.1"><h3 data-number="16.1.1" class="anchored" data-anchor-id="quest-ce-quune-api">
<span class="header-section-number">16.1.1</span> Qu’est-ce qu’une API ?</h3>
<p>Une <em>Application Programming Interface</em> (ou <strong>API</strong>) est une interface de programmation qui permet d’utiliser une application existante pour restituer des données. Le terme d’API peut être paraître intimidant, mais il s’agit simplement d’une façon de mettre à disposition des données : plutôt que de laisser l’utilisateur consulter directement des bases de données (souvent volumineuses et complexes), l’API lui propose de formuler une requête qui est traitée par le serveur hébergeant la base de données, puis de recevoir des données en réponse à sa requête.</p>
<p>D’un point de vue informatique, une API est une porte d’entrée clairement identifiée par laquelle un logiciel offre des services à d’autres logiciels (ou utilisateurs). L’objectif d’une API est de fournir un point d’accès à une fonctionnalité qui soit facile à utiliser et qui masque les détails de la mise en oeuvre. Par exemple, l’API Sirene permet de récupérer la raison sociale d’une entreprise à partir de son identifiant Siren en interrogeant le référentiel disponible sur Internet directement depuis un script <code>R</code>, sans avoir à connaître tous les détails du répertoire Sirene.</p>
<p>À l’Insee comme ailleurs, la connexion entre les bases de données pour les nouveaux projets tend à se réaliser par des API. L’accès à des données par des API devient ainsi de plus en plus commun et est amené à devenir une compétence de base de tout utilisateur de données.</p>
</section><section id="avantages-des-api" class="level3" data-number="16.1.2"><h3 data-number="16.1.2" class="anchored" data-anchor-id="avantages-des-api">
<span class="header-section-number">16.1.2</span> Avantages des API</h3>
<p>Les API présentent de multiples avantages :</p>
<ul>
<li>Les API rendent les programmes plus reproductibles. En effet, grâce aux API, il est possible de mettre à jour facilement les données utilisées par un programme si celles-ci évoluent. Cette flexibilité accrue pour l’utilisateur évite au producteur de données d’avoir à réaliser de multiples extractions, et réduit le problème de la coexistence de versions différentes des données.</li>
<li>Grâce aux API, l’utilisateur peut extraire facilement une petite partie d’une base de données plus conséquente.</li>
<li>Les API permettent de mettre à disposition des données tout en limitant le nombre de personnes ayant accès aux bases de données elles-mêmes.</li>
<li>Grâce aux API, il est possible de proposer des services sur mesure pour les utilisateurs (par exemple, un accès spécifique pour les gros utilisateurs).</li>
</ul></section><section id="utilisation-des-api" class="level3" data-number="16.1.3"><h3 data-number="16.1.3" class="anchored" data-anchor-id="utilisation-des-api">
<span class="header-section-number">16.1.3</span> Utilisation des API</h3>
<p>Une API peut souvent être utilisée de deux façons : par une interface Web, et par l’intermédiaire d’un logiciel (<code>R</code>, Python…). Par ailleurs, les API peuvent être proposées avec un niveau de liberté variable pour l’utilisateur :</p>
<ul>
<li>soit en libre accès (l’utilisation n’est pas contrôlée et l’utilisateur peut utiliser le service comme bon lui semble) ;</li>
<li>soit via la génération d’un compte et d’un jeton d’accès qui permettent de sécuriser l’utilisation de l’API et de limiter le nombre de requêtes.</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spécificité Insee
</div>
</div>
<div class="callout-body-container callout-body">
<p>Les API mises à disposition des utilisateurs par l’Insee se trouvent dans le <a href="https://api.insee.fr/catalogue/">catalogue des API</a>.</p>
</div>
</div>
<section id="consulter-linterface-web-dune-api" class="level4" data-number="16.1.3.1"><h4 data-number="16.1.3.1" class="anchored" data-anchor-id="consulter-linterface-web-dune-api">
<span class="header-section-number">16.1.3.1</span> Consulter l’interface Web d’une API</h4>
<p>Les API peuvent proposer une interface Web, mais ce n’est pas toujours le cas. Cette interface permet notamment :</p>
<ul>
<li>de s’inscrire aux différents services ;</li>
<li>de visualiser les différentes requêtes proposées par les services ;</li>
<li>de lancer l’API depuis cette plateforme ;</li>
<li>de proposer une documentation sur les API.</li>
</ul>
<p>L’utilisation de l’interface Web est utile dans une démarche exploratoire mais trouve rapidement ses limites, notamment lorsqu’on consulte régulièrement l’API. L’utilisateur va rapidement se rendre compte qu’il est beaucoup plus commode d’utiliser une API <em>via</em> un logiciel de traitement pour automatiser la consultation ou pour réaliser du téléchargement de masse. De plus, l’interface Web n’existe pas systématiquement pour toutes les API.</p>
</section><section id="requêter-une-api" class="level4" data-number="16.1.3.2"><h4 data-number="16.1.3.2" class="anchored" data-anchor-id="requêter-une-api">
<span class="header-section-number">16.1.3.2</span> Requêter une API</h4>
<p>Le mode principal de consultation d’une API consiste à adresser une requête à cette API <em>via</em> un logiciel adapté (<code>R</code>, <code>Python</code>, <code>Java</code>…). Comme pour l’utilisation d’une fonction, l’appel d’une API comprend des paramètres qui sont détaillées dans la documentation de l’API. Voici les éléments importants à avoir en tête sur les requêtes :</p>
<ul>
<li><p>Le <strong>point d’entrée</strong> d’un service offert par une API se présente sous la forme d’une URL (adresse web). Chaque service proposé par une API a sa propre URL. Par exemple, dans le cas de l’API Sirene, l’URL à utiliser pour obtenir des informations sur un Siren est : <a href="https://api.insee.fr/entreprises/sirene/V3/siren/" class="uri">https://api.insee.fr/entreprises/sirene/V3/siren/</a>.</p></li>
<li><p>Cette URL doit être complétée avec différents paramètres qui précisent la <strong>requête</strong> (par exemple l’identifiant Siren). Ces paramètres viennent s’ajouter à l’URL (qui peut donc devenir très longue!). Chaque service proposé par une API a ses propres paramètres, détaillés dans la documentation. S’agissant de l’API Sirene, l’utilisateur intéressé peut retrouver dans la documentation le paramétrage de l’URL.</p></li>
</ul>
<!-- Siren de la DG Insee: 120027016 --><ul>
<li><p>Lorsque l’utilisateur soumet sa requête, l’API lui renvoie une <strong>réponse structurée</strong> contenant l’ensemble des informations demandées. Le résultat envoyé par une API est majoritairement aux formats <code>JSON</code> ou <code>XML</code> (deux formats dans lesquels les informations sont hiérarchisées de manière emboîtée). Plus rarement, certains services proposent une information sous forme plate (de type csv).</p></li>
<li><p>Du fait de la dimension hiérarchique des formats <code>JSON</code> ou <code>XML</code>, le résultat n’est pas toujours facile à récupérer. Certains <em>packages</em>, comme <code>jsonlite</code> ou <code>xml2</code>, facilitent l’extraction de champs d’une sortie d’API. Dans certains cas, des <em>packages</em> spécifiques à une API ont été créés pour simplifier l’écriture d’une requête ou la récupération du résultat.</p></li>
</ul></section></section></section><section id="quelques-packages-permettant-une-utilisation-simple-des-api-des-données-insee" class="level2" data-number="16.2"><h2 data-number="16.2" class="anchored" data-anchor-id="quelques-packages-permettant-une-utilisation-simple-des-api-des-données-insee">
<span class="header-section-number">16.2</span> Quelques <em>packages</em> permettant une utilisation simple des API des données Insee</h2>
<p>Nous allons voir ici quelques <em>packages</em> permettant de traiter l’information d’une API facilement :</p>
<section id="le-package-apinsee" class="level3" data-number="16.2.1"><h3 data-number="16.2.1" class="anchored" data-anchor-id="le-package-apinsee">
<span class="header-section-number">16.2.1</span> Le <em>package</em> <a href="https://github.com/InseeFrLab/apinsee">apinsee</a>
</h3>
<p>Ce <em>package</em> est très utile pour l’utilisation des API mises à disposition sur le catalogue des API. En effet, pour ces API, pour pouvoir effectuer une requête, il est nécessaire de s’authentifier à différents niveaux :</p>
<ol type="1">
<li>S’authentifier grâce à une clé personnelle, associée à un compte créé sur <a href="https://api.insee.fr" class="uri">https://api.insee.fr</a> ;</li>
<li>Avoir un jeton d’accès temporaire. Ces jetons ont une durée de vie limitée et doivent régulièrement être renouvelés.</li>
</ol>
<p>Ce <em>package</em> propose de générer facilement un jeton d’accès temporaire à partir de <code>R</code>. De cette façon, il n’y a plus besoin de naviguer entre le programme <code>R</code> et le catalogue des API pour renouveler un jeton.</p>
<p>Pour utiliser cette fonctionnalité, il faut configurer l’usage du <em>package</em> lors de la première utilisation. Plus précisément, il faut renseigner les variables d’environnement <code>INSEE_APP_KEY</code> et <code>INSEE_APP_SECRET</code> dans le fichier de configuration <code>.Renviron</code> de <code>R</code>. (voir la fiche [Personnaliser la configuration de <code>R</code>] pour une présentation détaillée des fichiers de configuration de <code>R</code>). Pour le faire, il suffit d’exécuter la commande suivante :</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html">edit_r_environ</a></span><span class="op">(</span><span class="st">"user"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Votre fichier <code>.Renviron</code> est alors ouvert par RStudio s’il existe déjà. Si le fichier <code>.Renviron</code> n’existe pas encore, il est automatiquement créé (vide), enregistré et ouvert par <code>RStudio</code>. Il convient d’y ajouter deux variables d’environnement, <code>INSEE_APP_KEY</code> et <code>INSEE_APP_SECRET</code>. Les lignes suivantes peuvent servir de modèle, en remplaçant la deuxième partie de chaque ligne par la clé du compte à utiliser :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># clef du consommateur</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>INSEE_APP_KEY=xxxxxxxxxxxxxxxxxx</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu"># secret du consommateur</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>INSEE_APP_SECRET=yyyyyyyyyyyyyyyyyy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Voici deux remarques sur le stockage des variables d’environnement :</p>
<ul>
<li><p>L’option <code>"user"</code> dans l’utilisation de la fonction <code><a href="https://usethis.r-lib.org/reference/edit.html">usethis::edit_r_environ()</a></code> permet de stocker ces clés dans un fichier global, connu de tous les projets d’un utilisateur <code>R</code>. Cela évite, d’une part, de stocker la même information à deux endroits différents. D’autre part, cela évite d’associer des informations personnelles à un projet, qui doit être sous contrôle de version (voir la Fiche <a href="Fiche_git_utilisation.html">Utiliser R avec RStudio</a>) car le fichier <code>.Renviron</code> est un fichier contenant des informations personnelles.</p></li>
<li><p>Si vous avez choisi l’option <code>"project"</code> lors de l’appel à <code><a href="https://usethis.r-lib.org/reference/edit.html">usethis::edit_r_environ</a></code>, il faut ajouter le <code>.Renviron</code> dans les fichiers à ne pas suivre avec <code>Git</code> grâce à la commande suivante :</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html">edit_git_ignore</a></span><span class="op">(</span><span class="st">".Renviron"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Enfin, pour créer le token temporaire, il suffit d’exécuter :</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">apinsee</span><span class="fu">::</span><span class="fu">insee_auth</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ce token peut ensuite être utilisé comme valeur du paramètre token de la fonction <code><a href="https://httr.r-lib.org/reference/config.html">httr::config()</a></code> qui sert à contrôler les paramètres d’une requête vers internet faite par <code>R</code></p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/config.html">config</a></span><span class="op">(</span>token <span class="op">=</span> <span class="va">token</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dès lors, vous pouvez accéder aux API de l’Insee auxquelles votre application a souscrit.</p>
</section><section id="le-package-doremifasol" class="level3" data-number="16.2.2"><h3 data-number="16.2.2" class="anchored" data-anchor-id="le-package-doremifasol">
<span class="header-section-number">16.2.2</span> Le <em>package</em> <a href="https://inseefrlab.github.io/DoReMIFaSol">doremifasol</a>
</h3>
<p>Ce <em>package</em> permet entre autres de solliciter l’API Sirène dans une procédure de requêtage intégrée.</p>
<p><code>doremifasol</code> s’appuie sur le <em>package</em> <code>apinsee</code>, il faut donc renseigner les variables d’environnement décrites ci-dessus. Il reste ensuite à préciser le type d’information souhaitée (unités légales, établissements…) et la requête via l’argument <code>argsApi</code>. Par exemple, pour lister tous les bouchers de la ville de Tourcoing :</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bouchers_tourcoing</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">telechargerDonnees</span><span class="op">(</span></span>
<span>    <span class="st">"SIRENE_SIRET"</span>,</span>
<span>    argsApi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>q <span class="op">=</span> <span class="st">"codeCommuneEtablissement:59599 AND activitePrincipaleUniteLegale:47.22Z"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="le-package-inseelocaldata" class="level3" data-number="16.2.3"><h3 data-number="16.2.3" class="anchored" data-anchor-id="le-package-inseelocaldata">
<span class="header-section-number">16.2.3</span> Le <em>package</em> <a href="https://github.com/InseeFrLab/inseeLocalData">inseeLocalData</a>
</h3>
<p>Ce <em>package</em> permet de télécharger les données localisées à la commune, diffusées sur <a href="https://www.insee.fr" class="uri">https://www.insee.fr</a> dans la rubrique <em>Chiffres détaillés</em>, sous forme de cubes prédéfinis. Cette API est hébergée sur le catalogue des API de l’Insee. Une authentification par un jeton est donc nécessaire.</p>
<p>Le <em>package</em> comporte une fonction unique qui permet d’importer les données présentes dans l’API <em>Données Locales</em> dans une liste contenant 4 objets :</p>
<ul>
<li>les données statistiques ;</li>
<li>les modalités de chaque variable ;</li>
<li>l’information sur la zone demandée ;</li>
<li>l’information sur la source et le jeu de données demandé.</li>
</ul>
<p>Exemple d’utilisation du <em>package</em> pour importer le nombre d’entreprises et d’établissements en 2017 (en géographie au 01/01/2017) selon l’activité en 5 catégories et une indicatrice indiquant s’il s’agit d’une entreprise individuelle ou non pour la commune de Nantes :</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">inseeLocalData</span><span class="op">)</span></span>
<span></span>
<span><span class="va">croisement</span> <span class="op">&lt;-</span> <span class="st">"NA5_B-ENTR_INDIVIDUELLE"</span></span>
<span><span class="va">jeu_donnees</span> <span class="op">&lt;-</span> <span class="st">"GEO2017REE2017"</span></span>
<span><span class="va">nivgeo</span> <span class="op">&lt;-</span> <span class="st">"COM"</span></span>
<span><span class="va">codgeo</span> <span class="op">&lt;-</span> <span class="st">"44109"</span> <span class="co">#CODE GEO DE NANTES</span></span>
<span><span class="va">modalite</span> <span class="op">&lt;-</span> <span class="st">"all.all"</span></span>
<span></span>
<span><span class="va">donneesAPI</span> <span class="op">&lt;-</span> <span class="fu">get_dataset</span><span class="op">(</span><span class="va">jeton</span>, <span class="va">jeu_donnees</span>, <span class="va">croisement</span>, <span class="va">modalite</span>, <span class="va">nivgeo</span>, <span class="va">codgeo</span><span class="op">)</span></span>
<span></span>
<span><span class="va">donnees</span> <span class="op">&lt;-</span> <span class="va">donneesAPI</span><span class="op">$</span><span class="va">donnees</span> <span class="co"># pour accéder aux données</span></span>
<span><span class="va">liste_code</span> <span class="op">&lt;-</span> <span class="va">donneesAPI</span><span class="op">$</span><span class="va">liste_code</span> <span class="co"># pour accéder aux nomenclatures</span></span>
<span><span class="va">info_zone</span> <span class="op">&lt;-</span> <span class="va">donneesAPI</span><span class="op">$</span><span class="va">info_zone</span> <span class="co"># pour accéder aux données géographiques</span></span>
<span><span class="va">source</span> <span class="op">&lt;-</span> <span class="va">donneesAPI</span><span class="op">$</span><span class="va">source</span> <span class="co"># pour accéder à la source</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--- *TO BE COMPLETED: il faudrait plus de détails* --->
</section><section id="le-package-insee" class="level3" data-number="16.2.4"><h3 data-number="16.2.4" class="anchored" data-anchor-id="le-package-insee">
<span class="header-section-number">16.2.4</span> Le <em>package</em> <a href="https://github.com/InseeFr/R-Insee-Data/">insee</a>
</h3>
<p>Ce <em>package</em> permet de télécharger les données et leurs métadonnées diffusées sur le service <code>SDMX</code> de la Base de données Macroéconomique de l’Insee (BDM). Cette API étant ouverte, son accès ne demande pas d’identification, ni de jeton. Il est uniquement nécessaire de déterminer les données souhaitées soit via une liste de catégories (<code>idbank</code>), soit via une liste de données (<code>dataset</code>).</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead><tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Information</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Fonction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center; width: 3cm; font-weight: bold;">Liste des jeux de données</td>
<td style="text-align: center; width: 2cm;">insee::get_dataset_list()</td>
</tr>
<tr class="even">
<td style="text-align: center; width: 3cm; font-weight: bold;">Liste des séries</td>
<td style="text-align: center; width: 2cm;">insee::get_idbank_list()</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pyr-opendatafr.github.io/R-Insee-Data/">insee</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Importer les données à partir de leur idbank ou importer un dataset à partir de leur identifiant:</span></span>
<span><span class="va">table_bp</span> <span class="op">&lt;-</span> <span class="fu">get_insee_dataset</span><span class="op">(</span><span class="st">"BALANCE-PAIEMENTS"</span><span class="op">)</span></span>
<span><span class="va">indicateur_001694056</span> <span class="op">&lt;-</span> <span class="fu">get_insee_idbank</span><span class="op">(</span><span class="st">"001694056"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il est possible de rajouter des filtres à ces fonctions afin de limiter le nombre de données importées (filtre sur la période, sur la date de mise à jour, sur les filtres).</p>
<!----- **TO BE COMPLETED** ------->
</section><section id="le-package-oecd" class="level3" data-number="16.2.5"><h3 data-number="16.2.5" class="anchored" data-anchor-id="le-package-oecd">
<span class="header-section-number">16.2.5</span> Le <em>package</em> <a href="https://cran.r-project.org/web/packages/OECD/index.html">OECD</a>
</h3>
<p>Ce <em>package</em> permet de télécharger les données mises à disposition sur le site de l’<a href="https://stats.oecd.org/index.aspx?lang=fr">OCDE</a>. Cette API étant ouverte, son accès ne demande pas d’identification, ni de jeton. Il est uniquement nécessaire de déterminer les données souhaitées.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spécificité Insee
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ce <em>package</em> utilise la librairie <code>rsmdx</code> qui n’est pas compatible avec la technologie <em>Direct Access</em>. Il ne fonctionne pas en télétravail pour les postes nomades qui accèdent à internet par ce biais. En revanche il fonctionne sur site.</p>
</div>
</div>
<p>Voici quelques utilisations possibles de ce <em>package</em> :</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/expersso/OECD">OECD</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtenir la liste des tables présentes sur le site :</span></span>
<span><span class="va">dsets</span> <span class="op">&lt;-</span> <span class="fu">get_datasets</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Voir les métadonnées d'une table, via l'ouverture d'une page web (ici la table DUR_D) :</span></span>
<span><span class="fu">browse_metadata</span><span class="op">(</span><span class="st">"DUR_D"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Importer une table de données (ici la table DUR_D) :</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">get_dataset</span><span class="op">(</span><span class="st">"DUR_D"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="exemple-dutilisation-dune-api-sans-package" class="level2" data-number="16.3"><h2 data-number="16.3" class="anchored" data-anchor-id="exemple-dutilisation-dune-api-sans-package">
<span class="header-section-number">16.3</span> Exemple d’utilisation d’une API sans <em>package</em>
</h2>
<p>Les exemples précédents proposaient l’accès à une API par le biais d’un <em>package</em>. Pour lire les données d’une API ne possédant pas de <em>package</em>, il faut utiliser les deux <em>packages</em> <code>R</code> suivants :</p>
<ul>
<li>le <em>package</em> <code>httr</code> pour lancer la requête ;<br>
</li>
<li>puis le <em>package</em> <code>jsonlite</code> pour transformer en <code>data.frame</code> le résultat de la requête (qui est structurée en <code>JSON</code>).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Selon la structure du JSON récupéré, la manipulation du résultat d’une requête peut être assez fastidieuse avec <code>R</code>. <code>Python</code> propose des outils plus performants pour retravailler des JSON (le <em>package</em> <code>json</code> notamment). Heureusement, grâce au <em>package</em> <code>reticulate</code>, il est aisé de faire tourner un code <code>Python</code> dans une session <code>R</code> et récupérer le résultat dans un format de données (par exemple <code>data.frame</code>) de <code>R</code>. L’approche par les <code>API</code> étant plus fréquente en <code>Python</code> qu’en <code>R</code>, on trouve également plus de <em>packages</em> facilitant l’accès à des données par ce biais en <code>Python</code>.</p>
</div>
</div>
<section id="le-package-httr" class="level3" data-number="16.3.1"><h3 data-number="16.3.1" class="anchored" data-anchor-id="le-package-httr">
<span class="header-section-number">16.3.1</span> Le <em>package</em> <code>httr</code>
</h3>
<p>Le <em>package</em> <code>httr</code> permet de se connecter aux sites web et de se connecter aux API.</p>
<p>Il est possible de configurer la connexion internet localement sans modifier les variables système :</p>
<ul>
<li>
<code><a href="https://httr.r-lib.org/reference/set_config.html">set_config()</a></code> permet de configurer l’accès internet utilisée par les fonctions du <em>package</em>.<br>
</li>
<li>
<code><a href="https://httr.r-lib.org/reference/use_proxy.html">use_proxy()</a></code> permet de déterminer le proxy à utiliser. De nombreuses institutions utilisent passent par un intermédiaire, le proxy, pour accéder à internet. L’adresse du proxy est à ajouter au requête car sinon <code>R</code> ne sait pas communiquer avec internet. Il s’agit d’un paramètre à ajouter dans les options <code>httr</code>.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sous windows, le proxy peut être paramétré de la manière suivante:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">proxy</span> <span class="op">&lt;-</span> <span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/curl/reference/ie_proxy.html">ie_get_proxy_for_url</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/use_proxy.html">use_proxy</a></span><span class="op">(</span><span class="va">proxy</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Le <em>package</em> <code>httr</code> permet, lorsqu’on effectue une requête <code>GET</code> (une requête d’accès au résultat d’une recherche), de récupérer le résultat sous la forme d’un texte à retravailler.</p>
</section><section id="accès-à-une-api-sans-jeton" class="level3" data-number="16.3.2"><h3 data-number="16.3.2" class="anchored" data-anchor-id="accès-à-une-api-sans-jeton">
<span class="header-section-number">16.3.2</span> Accès à une API sans jeton</h3>
<p>En général, un appel à une API via <code>httr</code> s’effectue ainsi de la manière suivante :</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span></span>
<span>  <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>,             <span class="co"># url correspond à l'url à interroger</span></span>
<span>  as <span class="op">=</span> <span class="st">"text"</span>,                <span class="co"># type de la sortie renvoyée</span></span>
<span>  <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># type de la réponse de l'url</span></span>
<span>  encoding <span class="op">=</span> <span class="st">"UTF-8"</span>          <span class="co"># encodage de la réponse de l'url</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Prenons par exemple l’API d’<em>OpenFood Facts</em>, une base de données alimentaire. Imaginons qu’on désire récupérer l’information sur un produit. Cela s’obtient de la manière suivante :</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://world.openfoodfacts.org/api/v0/product/3017620425400.json"</span></span>
<span></span>
<span><span class="va">resultats</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span></span>
<span>    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>,             <span class="co"># url correspond à l'url à interroger</span></span>
<span>    as<span class="op">=</span><span class="st">"text"</span>,                  <span class="co"># type de la sortie renvoyée</span></span>
<span>    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># type de la réponse de l'url</span></span>
<span>    encoding<span class="op">=</span> <span class="st">"UTF-8"</span>            <span class="co"># encodage de la réponse de l'url</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le résultat est formaté sous forme de JSON, ce qui est pratique mais peu intelligible :</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/prettify.html">prettify</a></span><span class="op">(</span><span class="va">resultats</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
    "code": "3017620425400",
    "product": {
        "_id": "3017620425400",
        "_keywords": [
            "rspo",
            "pate",
            "cacao",
            "de",
            "ferrero",
            "sucre",
            "et",
            "huile",
            "durable",
            "aux",
            "chocolat",
            "tartiner",
            "au",
            "petit-dejeuner",
            "noisette",
            "palme",
            "nutella",
            "produit"
        ],
        "added_countries_tags": [

        ],
        "additives_n": 1,
        "additives_original_tags": [
            "en:e322i"
        ],
        "additives_tags": [
            "en:e322",
            "en:e322i"
        ],
        "allergens": "en:milk,en:nuts,en:soybeans",
        "allergens_debug_tags": [

        ],
        "allergens_from_ingredients": "en:soybeans, en:milk, en:nuts, NOISETTES , LAIT , SOJA, NOISETTES, LAIT, SOJA",
        "allergens_from_user": "(fr) en:milk,en:nuts,en:soybeans",
        "allergens_hierarchy": [
            "en:milk",
            "en:nuts",
            "en:soybeans"
        ],
        "allergens_tags": [
            "en:milk",
            "en:nuts",
            "en:soybeans"
        ],
        "amino_acids_prev_tags": [

        ],
        "amino_acids_tags": [

        ],
        "brands": "Ferrero, Nutella",
        "brands_old": "Nutella,Ferrero",
        "brands_tags": [
            "ferrero",
            "nutella"
        ],
        "carbon_footprint_from_known_ingredients_debug": "en:hazelnut-oil 13% x 2.6 = 33.8 g - ",
        "carbon_footprint_percent_of_known_ingredients": 13,
        "categories": "Petit-déjeuners, Produits à tartiner, Produits à tartiner sucrés, Pâtes à tartiner, Pâtes à tartiner aux noisettes, Pâtes à tartiner au chocolat, Pâtes à tartiner aux noisettes et au cacao",
        "categories_hierarchy": [
            "en:breakfasts",
            "en:spreads",
            "en:sweet-spreads",
            "fr:pates-a-tartiner",
            "en:hazelnut-spreads",
            "en:chocolate-spreads",
            "en:cocoa-and-hazelnuts-spreads"
        ],
        "categories_lc": "fr",
        "categories_old": "Petit-déjeuners, Produits à tartiner, Produits à tartiner sucrés, Pâtes à tartiner, Pâtes à tartiner aux noisettes, Pâtes à tartiner au chocolat, Pâtes à tartiner aux noisettes et au cacao",
        "categories_properties": {
            "agribalyse_food_code:en": "31032",
            "agribalyse_proxy_food_code:en": "31032",
            "ciqual_food_code:en": "31032"
        },
        "categories_properties_tags": [
            "all-products",
            "categories-known",
            "agribalyse-food-code-31032",
            "agribalyse-food-code-known",
            "agribalyse-proxy-food-code-31032",
            "agribalyse-proxy-food-code-known",
            "ciqual-food-code-31032",
            "ciqual-food-code-known",
            "agribalyse-known",
            "agribalyse-31032"
        ],
        "categories_tags": [
            "en:breakfasts",
            "en:spreads",
            "en:sweet-spreads",
            "fr:pates-a-tartiner",
            "en:hazelnut-spreads",
            "en:chocolate-spreads",
            "en:cocoa-and-hazelnuts-spreads"
        ],
        "category_properties": {
            "ciqual_food_name:en": "Chocolate spread with hazelnuts"
        },
        "checkers": [

        ],
        "checkers_tags": [

        ],
        "ciqual_food_name_tags": [
            "chocolate-spread-with-hazelnuts"
        ],
        "cities_tags": [

        ],
        "code": "3017620425400",
        "codes_tags": [
            "code-13",
            "3017620425xxx",
            "301762042xxxx",
            "30176204xxxxx",
            "3017620xxxxxx",
            "301762xxxxxxx",
            "30176xxxxxxxx",
            "3017xxxxxxxxx",
            "301xxxxxxxxxx",
            "30xxxxxxxxxxx",
            "3xxxxxxxxxxxx"
        ],
        "compared_to_category": "en:cocoa-and-hazelnuts-spreads",
        "complete": 0,
        "completeness": 0.7625,
        "correctors": [

        ],
        "correctors_tags": [
            "teolemon",
            "scanbot",
            "stephane",
            "tacite",
            "nicolasleger",
            "segundo",
            "jgonzale92",
            "charlesnepote",
            "packbot"
        ],
        "countries": "France, Suisse",
        "countries_debug_tags": [

        ],
        "countries_hierarchy": [
            "en:france",
            "en:switzerland"
        ],
        "countries_lc": "fr",
        "countries_tags": [
            "en:france",
            "en:switzerland"
        ],
        "created_t": 1350234941,
        "creator": "openfoodfacts-contributors",
        "data_quality_bugs_tags": [

        ],
        "data_quality_errors_tags": [

        ],
        "data_quality_info_tags": [
            "en:packaging-data-incomplete",
            "en:ingredients-percent-analysis-ok",
            "en:carbon-footprint-from-known-ingredients-but-not-from-meat-or-fish",
            "en:environmental-score-extended-data-not-computed",
            "en:food-groups-1-known",
            "en:food-groups-2-known",
            "en:food-groups-3-unknown"
        ],
        "data_quality_tags": [
            "en:packaging-data-incomplete",
            "en:ingredients-percent-analysis-ok",
            "en:carbon-footprint-from-known-ingredients-but-not-from-meat-or-fish",
            "en:environmental-score-extended-data-not-computed",
            "en:food-groups-1-known",
            "en:food-groups-2-known",
            "en:food-groups-3-unknown",
            "en:environmental-score-origins-of-ingredients-origins-are-100-percent-unknown",
            "en:environmental-score-packaging-unscored-shape",
            "en:environmental-score-production-system-no-label"
        ],
        "data_quality_warnings_tags": [
            "en:environmental-score-origins-of-ingredients-origins-are-100-percent-unknown",
            "en:environmental-score-packaging-unscored-shape",
            "en:environmental-score-production-system-no-label"
        ],
        "debug_param_sorted_langs": [
            "fr"
        ],
        "ecoscore_data": {
            "adjustments": {
                "origins_of_ingredients": {
                    "aggregated_origins": [
                        {
                            "epi_score": "0",
                            "origin": "en:unknown",
                            "percent": 100,
                            "transportation_score": 0
                        }
                    ],
                    "epi_score": 0,
                    "epi_value": -5,
                    "origins_from_categories": [
                        "en:unknown"
                    ],
                    "origins_from_origins_field": [
                        "en:unknown"
                    ],
                    "transportation_score": 0,
                    "transportation_scores": {
                        "ad": 0,
                        "al": 0,
                        "at": 0,
                        "ax": 0,
                        "ba": 0,
                        "be": 0,
                        "bg": 0,
                        "ch": 0,
                        "cy": 0,
                        "cz": 0,
                        "de": 0,
                        "dk": 0,
                        "dz": 0,
                        "ee": 0,
                        "eg": 0,
                        "es": 0,
                        "fi": 0,
                        "fo": 0,
                        "fr": 0,
                        "gg": 0,
                        "gi": 0,
                        "gr": 0,
                        "hr": 0,
                        "hu": 0,
                        "ie": 0,
                        "il": 0,
                        "im": 0,
                        "is": 0,
                        "it": 0,
                        "je": 0,
                        "lb": 0,
                        "li": 0,
                        "lt": 0,
                        "lu": 0,
                        "lv": 0,
                        "ly": 0,
                        "ma": 0,
                        "mc": 0,
                        "md": 0,
                        "me": 0,
                        "mk": 0,
                        "mt": 0,
                        "nl": 0,
                        "no": 0,
                        "pl": 0,
                        "ps": 0,
                        "pt": 0,
                        "ro": 0,
                        "rs": 0,
                        "se": 0,
                        "si": 0,
                        "sj": 0,
                        "sk": 0,
                        "sm": 0,
                        "sy": 0,
                        "tn": 0,
                        "tr": 0,
                        "ua": 0,
                        "uk": 0,
                        "us": 0,
                        "va": 0,
                        "world": 0,
                        "xk": 0
                    },
                    "transportation_value": 0,
                    "transportation_values": {
                        "ad": 0,
                        "al": 0,
                        "at": 0,
                        "ax": 0,
                        "ba": 0,
                        "be": 0,
                        "bg": 0,
                        "ch": 0,
                        "cy": 0,
                        "cz": 0,
                        "de": 0,
                        "dk": 0,
                        "dz": 0,
                        "ee": 0,
                        "eg": 0,
                        "es": 0,
                        "fi": 0,
                        "fo": 0,
                        "fr": 0,
                        "gg": 0,
                        "gi": 0,
                        "gr": 0,
                        "hr": 0,
                        "hu": 0,
                        "ie": 0,
                        "il": 0,
                        "im": 0,
                        "is": 0,
                        "it": 0,
                        "je": 0,
                        "lb": 0,
                        "li": 0,
                        "lt": 0,
                        "lu": 0,
                        "lv": 0,
                        "ly": 0,
                        "ma": 0,
                        "mc": 0,
                        "md": 0,
                        "me": 0,
                        "mk": 0,
                        "mt": 0,
                        "nl": 0,
                        "no": 0,
                        "pl": 0,
                        "ps": 0,
                        "pt": 0,
                        "ro": 0,
                        "rs": 0,
                        "se": 0,
                        "si": 0,
                        "sj": 0,
                        "sk": 0,
                        "sm": 0,
                        "sy": 0,
                        "tn": 0,
                        "tr": 0,
                        "ua": 0,
                        "uk": 0,
                        "us": 0,
                        "va": 0,
                        "world": 0,
                        "xk": 0
                    },
                    "value": -5,
                    "values": {
                        "ad": -5,
                        "al": -5,
                        "at": -5,
                        "ax": -5,
                        "ba": -5,
                        "be": -5,
                        "bg": -5,
                        "ch": -5,
                        "cy": -5,
                        "cz": -5,
                        "de": -5,
                        "dk": -5,
                        "dz": -5,
                        "ee": -5,
                        "eg": -5,
                        "es": -5,
                        "fi": -5,
                        "fo": -5,
                        "fr": -5,
                        "gg": -5,
                        "gi": -5,
                        "gr": -5,
                        "hr": -5,
                        "hu": -5,
                        "ie": -5,
                        "il": -5,
                        "im": -5,
                        "is": -5,
                        "it": -5,
                        "je": -5,
                        "lb": -5,
                        "li": -5,
                        "lt": -5,
                        "lu": -5,
                        "lv": -5,
                        "ly": -5,
                        "ma": -5,
                        "mc": -5,
                        "md": -5,
                        "me": -5,
                        "mk": -5,
                        "mt": -5,
                        "nl": -5,
                        "no": -5,
                        "pl": -5,
                        "ps": -5,
                        "pt": -5,
                        "ro": -5,
                        "rs": -5,
                        "se": -5,
                        "si": -5,
                        "sj": -5,
                        "sk": -5,
                        "sm": -5,
                        "sy": -5,
                        "tn": -5,
                        "tr": -5,
                        "ua": -5,
                        "uk": -5,
                        "us": -5,
                        "va": -5,
                        "world": -5,
                        "xk": -5
                    },
                    "warning": "origins_are_100_percent_unknown"
                },
                "packaging": {
                    "non_recyclable_and_non_biodegradable_materials": 0,
                    "packagings": [
                        {
                            "environmental_score_material_score": 0,
                            "environmental_score_shape_ratio": 0.2,
                            "food_contact": 0,
                            "material": "en:plastic",
                            "non_recyclable_and_non_biodegradable": "maybe",
                            "shape": "en:lid"
                        },
                        {
                            "environmental_score_material_score": 72,
                            "environmental_score_shape_ratio": 0.1,
                            "food_contact": 1,
                            "material": "en:heavy-aluminium",
                            "shape": "en:seal"
                        },
                        {
                            "environmental_score_material_score": 81,
                            "environmental_score_shape_ratio": 1,
                            "food_contact": 1,
                            "material": "en:glass",
                            "shape": "en:pot"
                        },
                        {
                            "environmental_score_material_score": 0,
                            "environmental_score_shape_ratio": 1,
                            "food_contact": 1,
                            "material": "en:unknown",
                            "shape": "en:jar"
                        }
                    ],
                    "score": -41.8,
                    "value": -14,
                    "warning": "unscored_shape"
                },
                "production_system": {
                    "labels": [

                    ],
                    "value": 0,
                    "warning": "no_label"
                },
                "threatened_species": {

                }
            },
            "agribalyse": {
                "agribalyse_food_code": "31032",
                "agribalyse_proxy_food_code": "31032",
                "co2_agriculture": 6.8500101,
                "co2_consumption": 0,
                "co2_distribution": 0.017263204,
                "co2_packaging": 0.17071537,
                "co2_processing": 0.3052603,
                "co2_total": 7.564940134,
                "co2_transportation": 0.22169116,
                "code": "31032",
                "dqr": "2.54",
                "ef_agriculture": 0.44346677,
                "ef_consumption": 0,
                "ef_distribution": 0.0046101581,
                "ef_packaging": 0.018565697,
                "ef_processing": 0.047606624,
                "ef_total": 0.5347352491,
                "ef_transportation": 0.020486,
                "is_beverage": 0,
                "name_en": "Chocolate spread with hazelnuts",
                "name_fr": "Pâte à tartiner chocolat et noisette",
                "score": 51,
                "version": "3.1.1"
            },
            "grade": "d",
            "grades": {
                "ad": "d",
                "al": "d",
                "at": "d",
                "ax": "d",
                "ba": "d",
                "be": "d",
                "bg": "d",
                "ch": "d",
                "cy": "d",
                "cz": "d",
                "de": "d",
                "dk": "d",
                "dz": "d",
                "ee": "d",
                "eg": "d",
                "es": "d",
                "fi": "d",
                "fo": "d",
                "fr": "d",
                "gg": "d",
                "gi": "d",
                "gr": "d",
                "hr": "d",
                "hu": "d",
                "ie": "d",
                "il": "d",
                "im": "d",
                "is": "d",
                "it": "d",
                "je": "d",
                "lb": "d",
                "li": "d",
                "lt": "d",
                "lu": "d",
                "lv": "d",
                "ly": "d",
                "ma": "d",
                "mc": "d",
                "md": "d",
                "me": "d",
                "mk": "d",
                "mt": "d",
                "nl": "d",
                "no": "d",
                "pl": "d",
                "ps": "d",
                "pt": "d",
                "ro": "d",
                "rs": "d",
                "se": "d",
                "si": "d",
                "sj": "d",
                "sk": "d",
                "sm": "d",
                "sy": "d",
                "tn": "d",
                "tr": "d",
                "ua": "d",
                "uk": "d",
                "us": "d",
                "va": "d",
                "world": "d",
                "xk": "d"
            },
            "missing": {
                "labels": 1,
                "origins": 1,
                "packagings": 1
            },
            "missing_data_warning": 1,
            "score": 32,
            "scores": {
                "ad": 32,
                "al": 32,
                "at": 32,
                "ax": 32,
                "ba": 32,
                "be": 32,
                "bg": 32,
                "ch": 32,
                "cy": 32,
                "cz": 32,
                "de": 32,
                "dk": 32,
                "dz": 32,
                "ee": 32,
                "eg": 32,
                "es": 32,
                "fi": 32,
                "fo": 32,
                "fr": 32,
                "gg": 32,
                "gi": 32,
                "gr": 32,
                "hr": 32,
                "hu": 32,
                "ie": 32,
                "il": 32,
                "im": 32,
                "is": 32,
                "it": 32,
                "je": 32,
                "lb": 32,
                "li": 32,
                "lt": 32,
                "lu": 32,
                "lv": 32,
                "ly": 32,
                "ma": 32,
                "mc": 32,
                "md": 32,
                "me": 32,
                "mk": 32,
                "mt": 32,
                "nl": 32,
                "no": 32,
                "pl": 32,
                "ps": 32,
                "pt": 32,
                "ro": 32,
                "rs": 32,
                "se": 32,
                "si": 32,
                "sj": 32,
                "sk": 32,
                "sm": 32,
                "sy": 32,
                "tn": 32,
                "tr": 32,
                "ua": 32,
                "uk": 32,
                "us": 32,
                "va": 32,
                "world": 32,
                "xk": 32
            },
            "status": "known"
        },
        "ecoscore_grade": "d",
        "ecoscore_score": 32,
        "ecoscore_tags": [
            "d"
        ],
        "editors": [
            "",
            "segundo",
            "teolemon",
            "tacite",
            "manu1400",
            "scanbot",
            "nicolasleger",
            "stephane"
        ],
        "editors_tags": [
            "segundo",
            "openfoodfacts-contributors",
            "scanbot",
            "teolemon",
            "packbot",
            "stephane",
            "manu1400",
            "tacite",
            "nicolasleger",
            "jgonzale92",
            "charlesnepote"
        ],
        "emb_codes": "",
        "emb_codes_20141016": "",
        "emb_codes_debug_tags": [

        ],
        "emb_codes_orig": "",
        "emb_codes_tags": [

        ],
        "entry_dates_tags": [
            "2012-10-14",
            "2012-10",
            "2012"
        ],
        "expiration_date": "",
        "expiration_date_debug_tags": [

        ],
        "food_groups": "en:sweets",
        "food_groups_tags": [
            "en:sugary-snacks",
            "en:sweets"
        ],
        "fruits-vegetables-nuts_100g_estimate": 0,
        "generic_name": "Pâte à tartiner aux noisettes",
        "generic_name_fr": "Pâte à tartiner aux noisettes",
        "generic_name_fr_debug_tags": [

        ],
        "id": "3017620425400",
        "image_front_small_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.200.jpg",
        "image_front_thumb_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.100.jpg",
        "image_front_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.400.jpg",
        "image_small_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.200.jpg",
        "image_thumb_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.100.jpg",
        "image_url": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.400.jpg",
        "images": {
            "1": {
                "sizes": {
                    "100": {
                        "h": 75,
                        "w": 100
                    },
                    "400": {
                        "h": 300,
                        "w": 400
                    },
                    "full": {
                        "h": 1920,
                        "w": 2560
                    }
                },
                "uploaded_t": 1350234942,
                "uploader": "openfoodfacts-contributors"
            },
            "2": {
                "sizes": {
                    "100": {
                        "h": 100,
                        "w": 75
                    },
                    "400": {
                        "h": 400,
                        "w": 300
                    },
                    "full": {
                        "h": 960,
                        "w": 720
                    }
                },
                "uploaded_t": 1358527087,
                "uploader": "openfoodfacts-contributors"
            },
            "front": {
                "geometry": "1632x1914-678-6",
                "imgid": "1",
                "normalize": null,
                "rev": "11",
                "sizes": {
                    "100": {
                        "h": 100,
                        "w": 85
                    },
                    "200": {
                        "h": 200,
                        "w": 171
                    },
                    "400": {
                        "h": 400,
                        "w": 341
                    },
                    "full": {
                        "h": 1914,
                        "w": 1632
                    }
                },
                "white_magic": null
            },
            "front_fr": {
                "geometry": "1632x1914-678-6",
                "imgid": "1",
                "normalize": null,
                "rev": "11",
                "sizes": {
                    "100": {
                        "h": 100,
                        "w": 85
                    },
                    "200": {
                        "h": 200,
                        "w": 171
                    },
                    "400": {
                        "h": 400,
                        "w": 341
                    },
                    "full": {
                        "h": 1914,
                        "w": 1632
                    }
                },
                "white_magic": null
            }
        },
        "informers": [
            "manu1400",
            "stephane"
        ],
        "informers_tags": [
            "manu1400",
            "stephane",
            "teolemon",
            "tacite",
            "nicolasleger",
            "segundo",
            "jgonzale92",
            "charlesnepote"
        ],
        "ingredients": [
            {
                "ciqual_proxy_food_code": "31016",
                "ecobalyse_code": "8f075c25-9ebf-430c-b41d-51d165c6e0d8",
                "id": "en:sugar",
                "is_in_taxonomy": 1,
                "percent_estimate": 39.275,
                "percent_max": 57.9,
                "percent_min": 20.65,
                "rank": 1,
                "text": "Sucre",
                "vegan": "yes",
                "vegetarian": "yes"
            },
            {
                "ciqual_food_code": "16129",
                "ecobalyse_code": "45658c32-66d9-4305-a34b-21d6a4cef89c",
                "from_palm_oil": "yes",
                "id": "en:palm-oil",
                "is_in_taxonomy": 1,
                "percent_estimate": 24.225,
                "percent_max": 35.45,
                "percent_min": 13,
                "rank": 2,
                "text": "Huile de palme",
                "vegan": "yes",
                "vegetarian": "yes"
            },
            {
                "ciqual_food_code": "15004",
                "ecobalyse_code": "hazelnut-unshelled-non-eu",
                "id": "en:hazelnut",
                "is_in_taxonomy": 1,
                "percent": 13,
                "percent_estimate": 13,
                "percent_max": 13,
                "percent_min": 13,
                "rank": 3,
                "text": "NOISETTES",
                "vegan": "yes",
                "vegetarian": "yes"
            },
            {
                "ciqual_food_code": "19054",
                "ecobalyse_code": "b6776a28-ec84-4bf3-988c-07b3c29f6136",
                "id": "en:skimmed-milk-powder",
                "is_in_taxonomy": 1,
                "percent": 8.7,
                "percent_estimate": 8.7,
                "percent_max": 8.7,
                "percent_min": 8.7,
                "rank": 4,
                "text": "LAIT écrémé en poudre",
                "vegan": "no",
                "vegetarian": "yes"
            },
            {
                "ciqual_proxy_food_code": "18100",
                "id": "en:fat-reduced-cocoa",
                "is_in_taxonomy": 1,
                "percent": 7.4,
                "percent_estimate": 7.4,
                "percent_max": 7.4,
                "percent_min": 7.4,
                "rank": 5,
                "text": "cacao maigre",
                "vegan": "yes",
                "vegetarian": "yes"
            },
            {
                "has_sub_ingredients": "yes",
                "id": "en:emulsifier",
                "is_in_taxonomy": 1,
                "percent_estimate": 3.7,
                "percent_max": 7.4,
                "percent_min": 0,
                "rank": 6,
                "text": "émulsifiant"
            },
            {
                "id": "en:vanillin",
                "is_in_taxonomy": 1,
                "percent_estimate": 3.69999999999999,
                "percent_max": 7.4,
                "percent_min": 0,
                "rank": 7,
                "text": "vanilline"
            },
            {
                "has_sub_ingredients": "yes",
                "id": "en:e322i",
                "is_in_taxonomy": 1,
                "percent_estimate": 3.7,
                "percent_max": 7.4,
                "percent_min": 0,
                "text": "lécithine",
                "vegan": "maybe",
                "vegetarian": "maybe"
            },
            {
                "ciqual_food_code": "42200",
                "id": "en:soya-lecithin",
                "is_in_taxonomy": 1,
                "percent_estimate": 3.7,
                "percent_max": 7.4,
                "percent_min": 0,
                "text": "lécithine de SOJA",
                "vegan": "yes",
                "vegetarian": "yes"
            }
        ],
        "ingredients_analysis": {
            "en:non-vegan": [
                "en:skimmed-milk-powder"
            ],
            "en:palm-oil": [
                "en:palm-oil"
            ],
            "en:vegan-status-unknown": [
                "en:vanillin"
            ],
            "en:vegetarian-status-unknown": [
                "en:vanillin"
            ]
        },
        "ingredients_analysis_tags": [
            "en:palm-oil",
            "en:non-vegan",
            "en:vegetarian-status-unknown"
        ],
        "ingredients_debug": [
            "Sucre",
            ",",
            null,
            null,
            null,
            " Huile de palme",
            ",",
            null,
            null,
            null,
            " NOISETTES 13%",
            ",",
            null,
            null,
            null,
            " LAIT écrémé en poudre 8",
            ",",
            null,
            null,
            null,
            "7%",
            ",",
            null,
            null,
            null,
            " cacao maigre 7",
            ",",
            null,
            null,
            null,
            "4%",
            ",",
            null,
            null,
            null,
            " émulsifiant ",
            ":",
            ":",
            null,
            null,
            "  lécithine ",
            "(",
            "(",
            null,
            null,
            "SOJA)",
            ",",
            null,
            null,
            null,
            " vanilline."
        ],
        "ingredients_from_or_that_may_be_from_palm_oil_n": 1,
        "ingredients_from_palm_oil_n": 1,
        "ingredients_from_palm_oil_tags": [
            "huile-de-palme"
        ],
        "ingredients_hierarchy": [
            "en:sugar",
            "en:added-sugar",
            "en:disaccharide",
            "en:palm-oil",
            "en:oil-and-fat",
            "en:vegetable-oil-and-fat",
            "en:palm-oil-and-fat",
            "en:hazelnut",
            "en:nut",
            "en:tree-nut",
            "en:skimmed-milk-powder",
            "en:dairy",
            "en:milk-powder",
            "en:fat-reduced-cocoa",
            "en:plant",
            "en:cocoa",
            "en:emulsifier",
            "en:vanillin",
            "en:e322i",
            "en:e322",
            "en:soya-lecithin"
        ],
        "ingredients_ids_debug": [
            "sucre",
            "huile-de-palme",
            "noisettes-13",
            "lait-ecreme-en-poudre-8",
            "7",
            "cacao-maigre-7",
            "4",
            "emulsifiant",
            "lecithine",
            "soja",
            "vanilline"
        ],
        "ingredients_lc": "fr",
        "ingredients_n": 9,
        "ingredients_n_tags": [
            "9",
            "1-10"
        ],
        "ingredients_non_nutritive_sweeteners_n": 0,
        "ingredients_original_tags": [
            "en:sugar",
            "en:palm-oil",
            "en:hazelnut",
            "en:skimmed-milk-powder",
            "en:fat-reduced-cocoa",
            "en:emulsifier",
            "en:vanillin",
            "en:e322i",
            "en:soya-lecithin"
        ],
        "ingredients_percent_analysis": 1,
        "ingredients_sweeteners_n": 0,
        "ingredients_tags": [
            "en:sugar",
            "en:added-sugar",
            "en:disaccharide",
            "en:palm-oil",
            "en:oil-and-fat",
            "en:vegetable-oil-and-fat",
            "en:palm-oil-and-fat",
            "en:hazelnut",
            "en:nut",
            "en:tree-nut",
            "en:skimmed-milk-powder",
            "en:dairy",
            "en:milk-powder",
            "en:fat-reduced-cocoa",
            "en:plant",
            "en:cocoa",
            "en:emulsifier",
            "en:vanillin",
            "en:e322i",
            "en:e322",
            "en:soya-lecithin"
        ],
        "ingredients_text": "Sucre, Huile de palme, NOISETTES 13%, LAIT écrémé en poudre 8,7%, cacao maigre 7,4%, émulsifiant : lécithine (SOJA), vanilline.",
        "ingredients_text_debug": "Sucre, Huile de palme, NOISETTES 13%, LAIT écrémé en poudre 8,7%, cacao maigre 7,4%, émulsifiant :  lécithine (SOJA), vanilline.",
        "ingredients_text_fr": "Sucre, Huile de palme, NOISETTES 13%, LAIT écrémé en poudre 8,7%, cacao maigre 7,4%, émulsifiant : lécithine (SOJA), vanilline.",
        "ingredients_text_fr_debug_tags": [

        ],
        "ingredients_text_with_allergens": "Sucre, Huile de palme, &lt;span class=\"allergen\"&gt;NOISETTES&lt;\/span&gt; &lt;\/span&gt;13%, &lt;span class=\"allergen\"&gt;LAIT&lt;\/span&gt; &lt;\/span&gt;écrémé en poudre 8,7%, cacao maigre 7,4%, émulsifiant : lécithine (&lt;span class=\"allergen\"&gt;SOJA&lt;\/span&gt;), vanilline.",
        "ingredients_text_with_allergens_fr": "Sucre, Huile de palme, &lt;span class=\"allergen\"&gt;NOISETTES&lt;\/span&gt; &lt;\/span&gt;13%, &lt;span class=\"allergen\"&gt;LAIT&lt;\/span&gt; &lt;\/span&gt;écrémé en poudre 8,7%, cacao maigre 7,4%, émulsifiant : lécithine (&lt;span class=\"allergen\"&gt;SOJA&lt;\/span&gt;), vanilline.",
        "ingredients_that_may_be_from_palm_oil_n": 0,
        "ingredients_that_may_be_from_palm_oil_tags": [

        ],
        "ingredients_with_specified_percent_n": 3,
        "ingredients_with_specified_percent_sum": 29.1,
        "ingredients_with_unspecified_percent_n": 4,
        "ingredients_with_unspecified_percent_sum": 70.9,
        "ingredients_without_ciqual_codes": [
            "en:e322i",
            "en:emulsifier",
            "en:vanillin"
        ],
        "ingredients_without_ciqual_codes_n": 3,
        "ingredients_without_ecobalyse_ids": [
            "en:e322i",
            "en:emulsifier",
            "en:fat-reduced-cocoa",
            "en:soya-lecithin",
            "en:vanillin"
        ],
        "ingredients_without_ecobalyse_ids_n": 5,
        "interface_version_created": "20120622",
        "interface_version_modified": "20150316.jqm2",
        "known_ingredients_n": 9,
        "labels": "en:Sustainable, Huile de palme durable, RSPO",
        "labels_hierarchy": [
            "en:sustainable",
            "en:sustainable-palm-oil",
            "en:roundtable-on-sustainable-palm-oil"
        ],
        "labels_lc": "fr",
        "labels_old": "en:Sustainable, Huile de palme durable, RSPO",
        "labels_tags": [
            "en:sustainable",
            "en:sustainable-palm-oil",
            "en:roundtable-on-sustainable-palm-oil"
        ],
        "lang": "fr",
        "lang_debug_tags": [

        ],
        "languages": {
            "en:french": 4
        },
        "languages_codes": {
            "fr": 4
        },
        "languages_hierarchy": [
            "en:french"
        ],
        "languages_tags": [
            "en:french",
            "en:1"
        ],
        "last_edit_dates_tags": [
            "2022-02-10",
            "2022-02",
            "2022"
        ],
        "last_editor": "packbot",
        "last_image_dates_tags": [
            "2013-01-18",
            "2013-01",
            "2013"
        ],
        "last_image_t": 1358527087,
        "last_modified_by": "packbot",
        "last_modified_t": 1703163083,
        "last_updated_t": 1743541326,
        "lc": "fr",
        "link": "http://www.ferrero.fr/nutella",
        "link_debug_tags": [

        ],
        "main_countries_tags": [

        ],
        "manufacturing_places": "",
        "manufacturing_places_debug_tags": [

        ],
        "manufacturing_places_tags": [

        ],
        "max_imgid": "2",
        "minerals_prev_tags": [

        ],
        "minerals_tags": [

        ],
        "misc_tags": [
            "en:environmental-score-computed",
            "en:environmental-score-missing-data-labels",
            "en:environmental-score-missing-data-origins",
            "en:environmental-score-missing-data-packagings",
            "en:environmental-score-missing-data-warning",
            "en:nutriscore-2021-e-2023-e",
            "en:nutriscore-2021-same-as-2023",
            "en:nutriscore-computed",
            "en:nutrition-all-nutriscore-values-known",
            "en:nutrition-fruits-vegetables-legumes-estimate-from-ingredients",
            "en:nutrition-fruits-vegetables-nuts-estimate-from-ingredients",
            "en:packagings-not-complete",
            "en:packagings-not-empty",
            "en:packagings-not-empty-but-not-complete",
            "en:packagings-number-of-components-4",
            "en:some-ingredients-with-specified-percent"
        ],
        "no_nutrition_data": "",
        "nova_group": 4,
        "nova_group_debug": "",
        "nova_groups": "4",
        "nova_groups_markers": {
            "3": [
                [
                    "ingredients",
                    "en:sugar"
                ],
                [
                    "ingredients",
                    "en:milk-powder"
                ]
            ],
            "4": [
                [
                    "additives",
                    "en:e322"
                ],
                [
                    "ingredients",
                    "en:emulsifier"
                ]
            ]
        },
        "nova_groups_tags": [
            "en:4-ultra-processed-food-and-drink-products"
        ],
        "nucleotides_prev_tags": [

        ],
        "nucleotides_tags": [

        ],
        "nutrient_levels": {
            "fat": "high",
            "salt": "low",
            "saturated-fat": "high",
            "sugars": "high"
        },
        "nutrient_levels_tags": [
            "en:fat-in-high-quantity",
            "en:saturated-fat-in-high-quantity",
            "en:sugars-in-high-quantity",
            "en:salt-in-low-quantity"
        ],
        "nutriments": {
            "carbohydrates": 57.3,
            "carbohydrates_100g": 57.3,
            "carbohydrates_unit": "g",
            "carbohydrates_value": 57.3,
            "carbon-footprint-from-known-ingredients_100g": 33.8,
            "carbon-footprint-from-known-ingredients_product": 254,
            "energy": 2273,
            "energy-kj": 2273,
            "energy-kj_100g": 2273,
            "energy-kj_unit": "kJ",
            "energy-kj_value": 2273,
            "energy-kj_value_computed": 2272.5,
            "energy_100g": 2273,
            "energy_unit": "kJ",
            "energy_value": 2273,
            "fat": 31.6,
            "fat_100g": 31.6,
            "fat_unit": "g",
            "fat_value": 31.6,
            "fiber": 3.4,
            "fiber_100g": 3.4,
            "fiber_unit": "g",
            "fiber_value": 3.4,
            "fruits-vegetables-legumes-estimate-from-ingredients_100g": 0,
            "fruits-vegetables-legumes-estimate-from-ingredients_serving": 0,
            "fruits-vegetables-nuts-estimate-from-ingredients_100g": 13,
            "fruits-vegetables-nuts-estimate-from-ingredients_serving": 13,
            "nova-group": 4,
            "nova-group_100g": 4,
            "nova-group_serving": 4,
            "nutrition-score-fr": 30,
            "nutrition-score-fr_100g": 30,
            "proteins": 6,
            "proteins_100g": 6,
            "proteins_unit": "g",
            "proteins_value": 6,
            "salt": 0.09398,
            "salt_100g": 0.09398,
            "salt_unit": "g",
            "salt_value": 0.09398,
            "saturated-fat": 10.9,
            "saturated-fat_100g": 10.9,
            "saturated-fat_unit": "g",
            "saturated-fat_value": 10.9,
            "sodium": 0.037592,
            "sodium_100g": 0.037592,
            "sodium_unit": "g",
            "sodium_value": 0.037592,
            "sugars": 56.7,
            "sugars_100g": 56.7,
            "sugars_unit": "g",
            "sugars_value": 56.7
        },
        "nutriscore": {
            "2021": {
                "category_available": 1,
                "data": {
                    "energy": 2273,
                    "energy_points": 6,
                    "energy_value": 2273,
                    "fiber": 3.4,
                    "fiber_points": 3,
                    "fiber_value": 3.4,
                    "fruits_vegetables_nuts_colza_walnut_olive_oils": 13,
                    "fruits_vegetables_nuts_colza_walnut_olive_oils_points": 0,
                    "fruits_vegetables_nuts_colza_walnut_olive_oils_value": 13,
                    "is_beverage": 0,
                    "is_cheese": 0,
                    "is_fat": 0,
                    "is_water": 0,
                    "negative_points": 26,
                    "positive_points": 3,
                    "proteins": 6,
                    "proteins_points": 3,
                    "proteins_value": 6,
                    "saturated_fat": 10.9,
                    "saturated_fat_points": 10,
                    "saturated_fat_value": 10.9,
                    "sodium": 37.592,
                    "sodium_points": 0,
                    "sodium_value": 37.6,
                    "sugars": 56.7,
                    "sugars_points": 10,
                    "sugars_value": 56.7
                },
                "grade": "e",
                "nutrients_available": 1,
                "nutriscore_applicable": 1,
                "nutriscore_computed": 1,
                "score": 23
            },
            "2023": {
                "category_available": 1,
                "data": {
                    "components": {
                        "negative": [
                            {
                                "id": "energy",
                                "points": 6,
                                "points_max": 10,
                                "unit": "kJ",
                                "value": 2273
                            },
                            {
                                "id": "sugars",
                                "points": 15,
                                "points_max": 15,
                                "unit": "g",
                                "value": 56.7
                            },
                            {
                                "id": "saturated_fat",
                                "points": 10,
                                "points_max": 10,
                                "unit": "g",
                                "value": 10.9
                            },
                            {
                                "id": "salt",
                                "points": 0,
                                "points_max": 20,
                                "unit": "g",
                                "value": 0.09
                            }
                        ],
                        "positive": [
                            {
                                "id": "fiber",
                                "points": 1,
                                "points_max": 5,
                                "unit": "g",
                                "value": 3.4
                            },
                            {
                                "id": "fruits_vegetables_legumes",
                                "points": 0,
                                "points_max": 5,
                                "unit": "%",
                                "value": 0
                            }
                        ]
                    },
                    "count_proteins": 0,
                    "count_proteins_reason": "negative_points_greater_than_or_equal_to_11",
                    "is_beverage": 0,
                    "is_cheese": 0,
                    "is_fat_oil_nuts_seeds": 0,
                    "is_red_meat_product": 0,
                    "is_water": 0,
                    "negative_points": 31,
                    "negative_points_max": 55,
                    "positive_nutrients": [
                        "fiber",
                        "fruits_vegetables_legumes"
                    ],
                    "positive_points": 1,
                    "positive_points_max": 10
                },
                "grade": "e",
                "nutrients_available": 1,
                "nutriscore_applicable": 1,
                "nutriscore_computed": 1,
                "score": 30
            }
        },
        "nutriscore_2021_tags": [
            "e"
        ],
        "nutriscore_2023_tags": [
            "e"
        ],
        "nutriscore_data": {
            "components": {
                "negative": [
                    {
                        "id": "energy",
                        "points": 6,
                        "points_max": 10,
                        "unit": "kJ",
                        "value": 2273
                    },
                    {
                        "id": "sugars",
                        "points": 15,
                        "points_max": 15,
                        "unit": "g",
                        "value": 56.7
                    },
                    {
                        "id": "saturated_fat",
                        "points": 10,
                        "points_max": 10,
                        "unit": "g",
                        "value": 10.9
                    },
                    {
                        "id": "salt",
                        "points": 0,
                        "points_max": 20,
                        "unit": "g",
                        "value": 0.09
                    }
                ],
                "positive": [
                    {
                        "id": "fiber",
                        "points": 1,
                        "points_max": 5,
                        "unit": "g",
                        "value": 3.4
                    },
                    {
                        "id": "fruits_vegetables_legumes",
                        "points": 0,
                        "points_max": 5,
                        "unit": "%",
                        "value": 0
                    }
                ]
            },
            "count_proteins": 0,
            "count_proteins_reason": "negative_points_greater_than_or_equal_to_11",
            "grade": "e",
            "is_beverage": 0,
            "is_cheese": 0,
            "is_fat_oil_nuts_seeds": 0,
            "is_red_meat_product": 0,
            "is_water": 0,
            "negative_points": 31,
            "negative_points_max": 55,
            "positive_nutrients": [
                "fiber",
                "fruits_vegetables_legumes"
            ],
            "positive_points": 1,
            "positive_points_max": 10,
            "score": 30
        },
        "nutriscore_grade": "e",
        "nutriscore_score": 30,
        "nutriscore_score_opposite": -30,
        "nutriscore_tags": [
            "e"
        ],
        "nutriscore_version": "2023",
        "nutrition_data": "on",
        "nutrition_data_per": "100g",
        "nutrition_data_per_debug_tags": [

        ],
        "nutrition_data_prepared": "",
        "nutrition_data_prepared_per": "100g",
        "nutrition_data_prepared_per_debug_tags": [

        ],
        "nutrition_grade_fr": "e",
        "nutrition_grades": "e",
        "nutrition_grades_tags": [
            "e"
        ],
        "nutrition_score_beverage": 0,
        "nutrition_score_debug": "",
        "nutrition_score_warning_fruits_vegetables_legumes_estimate_from_ingredients": 1,
        "nutrition_score_warning_fruits_vegetables_legumes_estimate_from_ingredients_value": 0,
        "nutrition_score_warning_fruits_vegetables_nuts_estimate_from_ingredients": 1,
        "nutrition_score_warning_fruits_vegetables_nuts_estimate_from_ingredients_value": 13,
        "origins": "",
        "origins_hierarchy": [

        ],
        "origins_lc": "fr",
        "origins_old": "",
        "origins_tags": [

        ],
        "other_nutritional_substances_tags": [

        ],
        "packaging": "Plastique, Verre, Bocal, Couvercle, Couvercle en plastique, Opercule aluminium, Pot en verre",
        "packaging_hierarchy": [
            "en:plastic",
            "en:glass",
            "en:jar",
            "en:lid",
            "fr:Couvercle en plastique",
            "fr:Opercule aluminium",
            "fr:Pot en verre"
        ],
        "packaging_lc": "fr",
        "packaging_materials_tags": [
            "en:aluminium",
            "en:glass",
            "en:plastic"
        ],
        "packaging_old": "Plastique, Verre, Bocal, Couvercle, Couvercle en plastique, Opercule aluminium, Pot en verre",
        "packaging_old_before_taxonomization": "Bocal,Verre,Couvercle,Plastique, couvercle en plastique, opercule aluminium, pot en verre",
        "packaging_recycling_tags": [

        ],
        "packaging_shapes_tags": [
            "en:jar",
            "en:lid",
            "en:pot",
            "en:seal"
        ],
        "packaging_tags": [
            "en:plastic",
            "en:glass",
            "en:jar",
            "en:lid",
            "fr:couvercle-en-plastique",
            "fr:opercule-aluminium",
            "fr:pot-en-verre"
        ],
        "packagings": [
            {
                "food_contact": 0,
                "material": "en:plastic",
                "shape": "en:lid"
            },
            {
                "food_contact": 1,
                "material": "en:aluminium",
                "shape": "en:seal"
            },
            {
                "food_contact": 1,
                "material": "en:glass",
                "shape": "en:pot"
            },
            {
                "food_contact": 1,
                "shape": "en:jar"
            }
        ],
        "packagings_materials": {
            "all": {

            },
            "en:glass": {

            },
            "en:metal": {

            },
            "en:plastic": {

            },
            "en:unknown": {

            }
        },
        "packagings_n": 4,
        "photographers": [

        ],
        "photographers_tags": [
            "openfoodfacts-contributors"
        ],
        "pnns_groups_1": "Sugary snacks",
        "pnns_groups_1_tags": [
            "sugary-snacks",
            "known"
        ],
        "pnns_groups_2": "Sweets",
        "pnns_groups_2_tags": [
            "sweets",
            "known"
        ],
        "popularity_key": 1,
        "popularity_tags": [
            "at-least-5-scans-2019",
            "top-75-percent-scans-2019",
            "top-80-percent-scans-2019",
            "top-85-percent-scans-2019",
            "top-90-percent-scans-2019",
            "top-100000-fr-scans-2019",
            "top-country-fr-scans-2019",
            "at-least-5-fr-scans-2019",
            "bottom-25-percent-scans-2020",
            "bottom-20-percent-scans-2020",
            "bottom-15-percent-scans-2020",
            "top-90-percent-scans-2020",
            "top-country-fr-scans-2020"
        ],
        "product_name": "Nutella",
        "product_name_fr": "Nutella",
        "product_name_fr_debug_tags": [

        ],
        "product_quantity": "750",
        "product_quantity_unit": "g",
        "product_type": "food",
        "purchase_places": "France",
        "purchase_places_debug_tags": [

        ],
        "purchase_places_tags": [
            "france"
        ],
        "quantity": "750 g",
        "quantity_debug_tags": [

        ],
        "removed_countries_tags": [

        ],
        "rev": 20,
        "scans_n": 1,
        "schema_version": 996,
        "selected_images": {
            "front": {
                "display": {
                    "fr": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.400.jpg"
                },
                "small": {
                    "fr": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.200.jpg"
                },
                "thumb": {
                    "fr": "https://images.openfoodfacts.org/images/products/301/762/042/5400/front_fr.11.100.jpg"
                }
            }
        },
        "serving_size_debug_tags": [

        ],
        "sortkey": 1610107187,
        "states": "en:to-be-completed, en:nutrition-facts-completed, en:ingredients-completed, en:expiration-date-to-be-completed, en:packaging-code-to-be-completed, en:characteristics-to-be-completed, en:origins-to-be-completed, en:categories-completed, en:brands-completed, en:packaging-completed, en:quantity-completed, en:product-name-completed, en:photos-to-be-validated, en:packaging-photo-to-be-selected, en:nutrition-photo-to-be-selected, en:ingredients-photo-to-be-selected, en:front-photo-selected, en:photos-uploaded",
        "states_hierarchy": [
            "en:to-be-completed",
            "en:nutrition-facts-completed",
            "en:ingredients-completed",
            "en:expiration-date-to-be-completed",
            "en:packaging-code-to-be-completed",
            "en:characteristics-to-be-completed",
            "en:origins-to-be-completed",
            "en:categories-completed",
            "en:brands-completed",
            "en:packaging-completed",
            "en:quantity-completed",
            "en:product-name-completed",
            "en:photos-to-be-validated",
            "en:packaging-photo-to-be-selected",
            "en:nutrition-photo-to-be-selected",
            "en:ingredients-photo-to-be-selected",
            "en:front-photo-selected",
            "en:photos-uploaded"
        ],
        "states_tags": [
            "en:to-be-completed",
            "en:nutrition-facts-completed",
            "en:ingredients-completed",
            "en:expiration-date-to-be-completed",
            "en:packaging-code-to-be-completed",
            "en:characteristics-to-be-completed",
            "en:origins-to-be-completed",
            "en:categories-completed",
            "en:brands-completed",
            "en:packaging-completed",
            "en:quantity-completed",
            "en:product-name-completed",
            "en:photos-to-be-validated",
            "en:packaging-photo-to-be-selected",
            "en:nutrition-photo-to-be-selected",
            "en:ingredients-photo-to-be-selected",
            "en:front-photo-selected",
            "en:photos-uploaded"
        ],
        "stores": "",
        "stores_debug_tags": [

        ],
        "stores_tags": [

        ],
        "teams": "pain-au-chocolat,shark-attack,stakano,chocolatine",
        "teams_tags": [
            "pain-au-chocolat",
            "shark-attack",
            "stakano",
            "chocolatine"
        ],
        "traces": "",
        "traces_debug_tags": [

        ],
        "traces_from_ingredients": "",
        "traces_from_user": "(fr) ",
        "traces_hierarchy": [

        ],
        "traces_tags": [

        ],
        "unique_scans_n": 1,
        "unknown_ingredients_n": 0,
        "unknown_nutrients_tags": [

        ],
        "update_key": "brands",
        "vitamins_prev_tags": [

        ],
        "vitamins_tags": [

        ]
    },
    "status": 1,
    "status_verbose": "product found"
}
 </code></pre>
</div>
</div>
<p>Pour en faire une information exploitable, il est nécessaire de retraiter le résultat de la requête. Par exemple, pour n’extraire que le libellé et le nutriscore d’un produit, ainsi que son indice de transformation NOVA, il faut utiliser une boucle sur les différentes caractéristiques à extraire :</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"product_name"</span>,<span class="st">"nova_groups"</span>,<span class="st">"nutriscore_grade"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">resultats</span>, flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">product</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"product_name"</span>,<span class="st">"nova_groups"</span>,<span class="st">"nutriscore_grade"</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  product_name nova_groups nutriscore_grade
1      Nutella           4                e</code></pre>
</div>
</div>
</section><section id="accès-à-une-api-avec-jeton" class="level3" data-number="16.3.3"><h3 data-number="16.3.3" class="anchored" data-anchor-id="accès-à-une-api-avec-jeton">
<span class="header-section-number">16.3.3</span> Accès à une API avec jeton</h3>
<p>Pour les API protégées par des jetons, il faut rajouter un paramètre d’identification. Les jetons d’authentification (<em>token</em>) étant des informations personnelles, il ne faut pas les faire figurer dans un script. Comme expliqué précédemment, ils peuvent être stockés sous forme de variable d’environnement, par exemple sous le nom <code>MON_JETON_SECRET</code>. Il suffit alors d’utiliser <code>Sys.getenv</code> pour récupérer la valeur derrière le nom <code>MON_JETON_SECRET</code> :</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jeton</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"MON_JETON_SECRET"</span><span class="op">)</span> <span class="co"># création d'une variable contenant le jeton</span></span>
<span></span>
<span><span class="va">auth_header</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/add_headers.html">add_headers</a></span><span class="op">(</span><span class="st">'Authorization'</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'Bearer'</span>,<span class="va">jeton</span><span class="op">)</span><span class="op">)</span> <span class="co"># création d'une variable d'authentification</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>,</span>
<span>                     <span class="va">auth_header</span>, <span class="co"># ajout de la variable d'authentification</span></span>
<span>                     as<span class="op">=</span><span class="st">"text"</span>, </span>
<span>                     <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                     encoding<span class="op">=</span><span class="st">'UTF-8'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="le-package-jsonlite" class="level3" data-number="16.3.4"><h3 data-number="16.3.4" class="anchored" data-anchor-id="le-package-jsonlite">
<span class="header-section-number">16.3.4</span> Le <em>package</em> <code>jsonlite</code>
</h3>
<p>Ce <em>package</em> propose principalement la fonction <code>fromJSON</code> qui permet de convertir une résultat en format <code>json</code> en un objet <code>R</code>.</p>
</section><section id="temporisation" class="level3" data-number="16.3.5"><h3 data-number="16.3.5" class="anchored" data-anchor-id="temporisation">
<span class="header-section-number">16.3.5</span> Temporisation</h3>
<p>Pour l’utilisation d’API avec un jeton, comme celle proposées sur le catalogue des API de l’Insee, le nombre de requête par minute est limité (30 pour un compte standard sur le catalogue des API). Pour ne pas être bloqué par cette limite, il est important de temporiser les appels successifs en introduisant une latence. La fonction permettant cela est <code>Sys.sleep</code>. Par exemple, pour laisser 30 secondes d’attente, taper <code>Sys.sleep(30)</code>.</p>
<p><strong>Exemple d’utilisation sur l’API interne RMèS</strong></p>
<p>Une API interne sur les métadonnées de l’Insee est disponible (programme <code>RMès</code>). Elle permet d’obtenir de manière simplifiée des métadonnées (sources, concepts, liste de codes géographiques). Comme cette API est disponible en interne à l’Insee, il n’y a pas, comme pour accéder à celles sur internet, de proxy.</p>
<p>Voici un exemple de requête pour accéder aux données au niveau division de la <code>Naf-rev2</code> :</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># L'API est disponible en interne. Il n'y a pas de proxy pour cette API</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/use_proxy.html">use_proxy</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># url de la requête : ici on souhaite afficher la naf rev 2</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"url_de_la_requete"</span></span>
<span></span>
<span></span>
<span><span class="co"># connexion à l'API pour récupérer les données en JSON</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>,</span>
<span>                     as<span class="op">=</span><span class="st">"text"</span>, <span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>, encoding<span class="op">=</span><span class="st">'UTF-8'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transformation des données pour les transformer en dataframe</span></span>
<span><span class="va">res_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># travail de la table pour obtenir le niveau division de la NAF-rev2</span></span>
<span><span class="va">division</span> <span class="op">&lt;-</span> <span class="va">res_ok</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">uri</span>,<span class="st">'division'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'code'</span>, <span class="st">'intituleFr'</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spécificité Insee
</div>
</div>
<div class="callout-body-container callout-body">
<p>L’URL de cette API est uniquement disponible en interne à l’Insee. Elle n’est pas rendu publique pour des raisons de sécurité.</p>
</div>
</div>
</section><section id="exemple-dutilisation-de-lapi-sirene" class="level3" data-number="16.3.6"><h3 data-number="16.3.6" class="anchored" data-anchor-id="exemple-dutilisation-de-lapi-sirene">
<span class="header-section-number">16.3.6</span> Exemple d’utilisation de l’<a href="https://api.insee.fr/catalogue/site/themes/wso2/subthemes/insee/pages/item-info.jag?name=Sirene&amp;version=V3&amp;provider=insee">API Sirene</a>
</h3>
<p>Cet exemple va aller chercher les liens de succession pour un établissement :</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">apinsee</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://api.insee.fr/entreprises/sirene/V3/siret/liensSuccession?q=siretEtablissementPredecesseur:39478192600016"</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/URLencode.html">URLencode</a></span><span class="op">(</span><span class="va">url</span>, reserved <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">insee_auth</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/config.html">config</a></span><span class="op">(</span>token <span class="op">=</span> <span class="va">token</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span>, <span class="fu"><a href="https://httr.r-lib.org/reference/config.html">config</a></span><span class="op">(</span>token <span class="op">=</span> <span class="va">token</span><span class="op">)</span><span class="op">)</span>, </span>
<span>               as<span class="op">=</span><span class="st">"text"</span>, </span>
<span>               <span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>               encoding<span class="op">=</span><span class="st">'UTF-8'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="va">sortie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">liensSuccession</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>L’API Sirene permet d’effectuer des recherches multicritères. Dans ce cas, il faut séparer les codes par <code>%20OR%20</code> (code HTML signifiant <code>OR</code>) :</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://api.insee.fr/entreprises/sirene/V3/siret/liensSuccession?q=siretEtablissementPredecesseur%3A39478192600016%20OR%20siretEtablissementPredecesseur%3A39488939800027"</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu">apinsee</span><span class="fu">::</span><span class="fu">insee_auth</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/set_config.html">set_config</a></span><span class="op">(</span><span class="fu"><a href="https://httr.r-lib.org/reference/config.html">config</a></span><span class="op">(</span>token <span class="op">=</span> <span class="va">token</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/content.html">content</a></span><span class="op">(</span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="va">url</span>, <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/config.html">config</a></span><span class="op">(</span>token <span class="op">=</span> <span class="va">token</span><span class="op">)</span><span class="op">)</span>, </span>
<span>               as<span class="op">=</span><span class="st">"text"</span>, </span>
<span>               <span class="fu"><a href="https://httr.r-lib.org/reference/content_type.html">content_type_json</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>               encoding<span class="op">=</span><span class="st">'UTF-8'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span><span class="op">&lt;-</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="va">sortie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">liensSuccession</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-----
## Références
------->
<!----
Liste des API utiles:
TO BE COMPLETED
------>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../03_Fiches_thematiques/Fiche_import_fichiers_parquet.html" class="pagination-link" aria-label="Lire et écrire des fichiers Parquet">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Lire et écrire des fichiers Parquet</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../03_Fiches_thematiques/Fiche_connexion_bdd.html" class="pagination-link" aria-label="Se connecter à une base de données">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Se connecter à une base de données</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/InseeFrLab/utilitR/edit/master/03_Fiches_thematiques/Fiche_api.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/InseeFrLab/utilitR/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<li>
<a href="https://github.com/InseeFrLab/utilitR.git" target="blank">Code source</a>
</li>
</div>
  </div>
</footer>


</body></html>
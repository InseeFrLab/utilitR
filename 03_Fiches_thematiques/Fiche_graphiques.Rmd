# Produire des graphiques en `ggplot2`

Cette fiche est une introduction au *package* `ggplot2` d'[Hadley Wickham](http://hadley.nz/). Pour des formations plus détaillées, se référer à {#ggplot2Ressources}


## Plan temporaire de la fiche

Source1: https://juba.github.io/tidyverse/08-ggplot2.html
Source2: https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html

### Introduction aux graphiques en `R` (éventuellement sous la forme d'une petite fiche détachable)

#### L'add-in esquisse

Reprendre le 8.9 de source1.

#### Eventuellement: `ggformula`

## Début de la fiche `ggplot2`

### Les éléments clés d'un ggplot

Reprendre le 4.3 de source2.

### Bien détailler le mapping (c'est le plus compliqué en ggplot)

Reprendre le 5 de source2 (sans l'exercice). Bien expliquer la différence entre ce qui est dans `aes()` et en-dehors.

### Présenter quelques geometries

Reprendre le 8.3 de source1 et/ou le 6 de source2.

### Les options des graphiques

Titre, légendes, axes, scales, xlim/ylim.

Reprendre le 7 et le 9 de source2.

### Exporter un graphique

Reprendre le 12 de source2.

### Sources (ne pas oublier de nommer les auteurs)

Source1: https://juba.github.io/tidyverse/08-ggplot2.html
Source2: https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html

### Références

Reprendre le 8.10 de source1.
Penser à mettre des liens vers les galeries ggplot2.





## Introduction

::: remarque
Le *package* `ggplot2` est basé sur la notion de **grammaire graphique** de [Leland Wilkinson](https://www.jstatsoft.org/index.php/jss/article/view/v017b03/v17b03.pdf), qui décompose chaque graphique en un ensemble d'éléments paramétrables :

1. les données
2. les géométries (*layers*) : barres, lignes, polygones, ...
3. les éléments d'échelle et de systèmes de coordonnées
4. les élements d'apparence (titre, thèmes, ...).

Il est possible de tracer des graphiques à partir d'un fichier détail ou de données agrégées.
:::

La construction d'un graphique repose sur le principe de couches successives :

La fonction `ggplot2::ggplot()` permet de déclarer la table de données à représenter (argument `data`) et les variables à représenter (argument `mapping` et fonction `aes()`).

Les différentes couches graphiques se superposent et s'enchainent grâce à l'opérateur `+`, comme un pipe.

## Les différentes façons de faire du `ggplot2`

Plusieurs solutions s'offrent à l'utilisateur de `ggplot2` :

1. saisir des instructions dans un script
2. utiliser [`ggformula`](https://cran.r-project.org/web/packages/ggformula/vignettes/ggformula-blog.html), surcouche à `ggplot2` qui *simplifie* légèrement la syntaxe
3. [`esquisse`](https://cran.r-project.org/web/packages/esquisse/readme/README.html), *add-in* qui permet de réaliser des graphiques en *drag and drop*.

## Mon premier graphique

Nous utiliserons le *set* de données `diamonds`, qui contient des mesures de 54 000 diamants (carat, taille, couleur, clarté, prix, ...).

```{r, eval=TRUE}
library("ggplot2")
data("diamonds")
str(diamonds)
```

Un aperçu des données :

```{r, eval=TRUE}
knitr::kable(head(diamonds))
```

Dans un premier temps, nous souhaitons représenter, sous forme de diagramme en barre, le nombre de diamant par clarté (variable `clarity`)
```{r, eval=TRUE}
ggplot2::ggplot(data = diamonds, mapping = aes(x = clarity)) +
	geom_bar()
```

A noter que l'instruction peut également s'écrire ainsi :

```{r, eval=FALSE}
ggplot2::ggplot() +
	geom_bar(data = diamonds, mapping = aes(x = clarity))

# ou

ggplot2::ggplot(data = diamonds) +
	geom_bar(mapping = aes(x = clarity)
```

La fonction `aes()` (*aesthetic mappings*) permet d'identifier les variables à représenter, et de modifier l'apparence du graphique en fonction de celles-ci (taille, couleur, forme, ...).

Nous voulons maintenant représenter dans un nuage de point les diamants par carat et prix. La couleur des points dépendra de la variable clarté
```{r, eval=TRUE}
ggplot2::ggplot(data = diamonds) +
	geom_point(mapping = aes(x = carat, y = price, colour = clarity))
```

## Les principales formes géométriques

* le nuage de point (`geom_point()`) ;
* le diagramme en barre (`geom_bar` avec l'argument `position = dodge, fill, stack`) ;
* les histogrammes (`geom_histogram()`) ;
* les courbes (`geom_line()`) ;
* les boites à moustache (`geom_boxplot()`).

## Créer un graphique par modalité d'une variable

La fonction `facet_wrap()` permet de représenter des données *en facettes*, c'est à dire décomposées par une variable de croisement.

```{r, eval=TRUE}
ggplot2::ggplot(data = diamonds) +
	geom_point(mapping = aes(x = carat, y = price)) +
	facet_wrap(~cut)
```

## Ressources {#ggplot2Ressources}

		- le [site internet de `ggplot2`](https://ggplot2.tidyverse.org/)
		- la [refcard](https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf)
		- la [formation de Martin Chevalier](https://teaching.slmc.fr/perf/index.html#r%C3%A9aliser_des_graphiques_avec_r)
		- le [site de Julien Barnier](https://juba.github.io/tidyverse/08-ggplot2.html)
		- les [formations du MTES](https://mtes-mct.github.io/parcours-r/m5/package-ggplot2.html)
    - plein d'autres ...

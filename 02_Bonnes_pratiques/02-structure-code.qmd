# Structure des projets {#code-structure}

## TÃ¢ches concernÃ©es et recommandations

L'utilisateur souhaite amÃ©liorer la structuration de ses projets `R` afin de favoriser leur maintenabilitÃ© et leur rÃ©utilisation.

::: {.callout-recommandation .icon}
- Il est recommandÃ© d'utiliser systÃ©matiquement les projets `RStudio` dans
des projets impliquant des programmes {{< fa brands r-project >}}.
- Il est recommandÃ© de structurer les projets en dossiers thÃ©matiques
(donnÃ©es, code, sorties, documentation) et d'organiser ces dossiers
afin de sÃ©parer les entrÃ©es d'une chaÃ®ne de traitement, les objets intermÃ©diaires et les sorties.
- Il est recommandÃ© d'adopter des noms signifiants pour les fichiers et de ne
jamais utiliser des espaces dans les noms de dossiers et fichiers.
- Il est recommandÃ© d'accorder une attention particuliÃ¨re au fichier `README.md`.
:::

Cette partie dÃ©taille de maniÃ¨re plus Ã©tendue les Ã©lÃ©ments enseignÃ©s
dans le cadre d'une formation aux bonnes pratiques 
construite par l'Insee et dont les supports ont Ã©tÃ© ouverts Ã  
[cette adresse](https://inseefrlab.github.io/formation-bonnes-pratiques-R/#/title-slide).


## Enjeux

On peut comparer la structure d'un projet Ã  l'organisation d'un bureau. 
Si ce dernier est dÃ©sordonnÃ©, il est trÃ¨s difficile de dissocier les dossiers
et de ne pas prendre beaucoup de temps, voire abandonner toute recherche, 
lorsqu'il est nÃ©cessaire d'en retrouver un. A l'inverse, un bureau bien
organisÃ©, et au sein de ce bureau des dossiers bien rangÃ©s, faciliteront
la recherche d'information. Le bon fonctionnement d'un projet informatique
est identique. Un projet bien structurÃ©, avec une organisation sensÃ©e, 
amÃ©liorera la lisibilitÃ© du projet ainsi que sa maintenabilitÃ©. 

Prenons l'organisation suivante, Ã  ne pas reproduire: 

```
â”œâ”€â”€ report.Rmd
â”œâ”€â”€ correlation.png
â”œâ”€â”€ data.csv
â”œâ”€â”€ data2.csv
â”œâ”€â”€ fig1.png
â”œâ”€â”€ figure 2 (copy).png
â”œâ”€â”€ report.pdf
â”œâ”€â”€ partial data.csv
â”œâ”€â”€ script.R
â””â”€â”€ script_final.R
```

Source : [eliocamp.github.io](https://eliocamp.github.io/reproducibility-with-r/materials/day1/02-projects/)

Sans une documentation claire sur l'organisation du projet, il est trÃ¨s difficile de comprendre la hiÃ©rarchie et l'ordre d'exÃ©cution des scripts, 
de sÃ©parer les bases qui sont en entrÃ©e du traitement de celles produites par le traitement, 
d'Ãªtre certain que toutes les productions sont issues du traitement et non de copier-coller manuels
et d'Ãªtre certain que toutes les productions ont Ã©tÃ© faites Ã  partir de la 
derniÃ¨re version du code. 


Comme pour le rangement d'un bureau, la mÃ©thode
la plus efficace n'est pas d'attendre que la situation devienne ingÃ©rable
mais d'organiser en continu le projet. `Git` est un outil qui favorise
cette bonne pratique, puisqu'il Ã©vite la duplication des fichiers, mais
il ne s'agit pas d'un outil miraculeux. 
Il est donc recommandÃ© d'adopter des conventions, assez similaires Ã  celles
proposÃ©es dans la fiche [QualitÃ© du code](#code-quality). 
par exemple l'autodocumentation par 
des conventions de nommage cohÃ©rentes et l'organisation du projet dans des noms
de dossiers logiques
pour permettre Ã  d'autres de comprendre l'objectif d'un projet, 
sa structure et ses productions. 

Les principes gÃ©nÃ©raux sont les suivants, dÃ©taillÃ©s dans les parties qui 
suivent:

1. Utiliser les projets RStudio ;
2. Organiser son projet en sous-dossiers numÃ©rotÃ©s ;
3. Donner des noms pertinents aux fichiers et dossiers ;
4. Documenter son projet.


Il est important d'Ãªtre vigilant sur la bonne structuration
d'un projet car un code mal structurÃ© limite la lisibilitÃ© du projet
et est trÃ¨s coÃ»teux Ã  maintenir (concept de la dette technique).


::: {layout="[80,30]"}

![](https://www.earthdatascience.org/images/earth-analytics/clean-code/reproducible-science-is-about-being-lazy-hadley-wickham.png)

:::

## Utiliser les projets RStudio

Une [fiche dÃ©taillÃ©e](#rproject) est consacrÃ©e aux projets `RStudio`.
Les principaux avantages des projets `RStudio` sont les suivants:

  - Tous les fichiers nÃ©cessaires au projet sont dans un mÃªme dossier ;
  - Le dossier contenant le projet RStudio est automatiquement utilisÃ© comme ***working directory*** ;
  - Ils utilisent des [**chemins relatifs**]{.blue2} plutÃ´t qu'absolus.

Cela peut aider Ã  Ã©viter les problÃ¨mes de chemin lors de la reprise du projet sur un autre ordinateur ou avec une autre personne. 

Si vous suivez le mode opÃ©ratoire pour l'utilisation de `Git` dans `RStudio`
dÃ©taillÃ© dans la [fiche dÃ©diÃ©e](#Fiche_git_utilisation), vous Ãªtes assurÃ©
de travailler dans un projet `RStudio`.

## Organiser son projet en sous-dossiers

Comme toute convention, toute structure de dossier comporte une certaine
forme d'arbitraire et il n'apparaÃ®t pas toujours Ã©vident de considÃ©rer
qu'une rÃ¨gle d'organisation est plus lÃ©gitime qu'une autre. Il est plus important
de chercher des structures lisibles et cohÃ©rentes, admises par une communautÃ©
large de praticiens d'un langage. 

Pour reprendre l'exemple prÃ©cÃ©dent, une structure dÃ©jÃ  plus lisible
est la suivante:

```
â”œâ”€â”€ data
â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ data.csv
â”‚   â”‚   â””â”€â”€ data2.csv
â”‚   â””â”€â”€ derived
â”‚       â””â”€â”€ partial data.csv
â”œâ”€â”€ scripts
â”‚   â””â”€â”€ script.R
â”œâ”€â”€ analysis
â”‚   â”œâ”€â”€ script_final.R
â”‚   â””â”€â”€ report.Rmd
â””â”€â”€ output
    â”œâ”€â”€ fig1.png
    â”œâ”€â”€ figure 2 (copy).png
    â”œâ”€â”€ figure10.png
    â”œâ”€â”€ correlation.png
    â””â”€â”€ report.pdf
```
Dans cette organisation : 
- le dossier `data` vise Ã  stocker les donnÃ©es locales utilisÃ©es par le projet. Le dossier `raw` contient les donnÃ©es de base, qui doivent rester immuables. Le dossier `derived` peut contenir des tables intermÃ©diaires produites Ã  partir des donnÃ©es de base ;
- la dossier `scripts` contient les scripts qui rÃ©alisent des traitements de donnÃ©es : tÃ©lÃ©chargement, import, nettoyage, etc. ;
- le dossier `analysis` contient les scripts qui rÃ©alisent une analyse statistique et/ou une mise en forme sous forme de rapport ;
- le dossier `output` contient les fichiers gÃ©nÃ©rÃ©s par le projet : rapports, figures, etc. Ces fichiers doivent toujours pouvoir Ãªtre re-gÃ©nÃ©rÃ©s par le code prÃ©sent dans le projet, par souci de reproductibilitÃ©.
## Donner des noms pertinents aux fichiers

La structure prÃ©cÃ©dente est dÃ©jÃ  plus claire. NÃ©anmoins, 
au sein de chaque dossier, l'organisation est encore perfectible. 
En donnant des noms clairs aux fichiers et en sÃ©parant au sein de chaque dossier
les diffÃ©rents niveaux, on comprend beaucoup mieux l'organisation du projet
et ainsi la chaine de production. 

```
â”œâ”€â”€ data
â”‚   â”œâ”€â”€ raw
â”‚   â”‚   â”œâ”€â”€ dpe_logement_202103.csv
â”‚   â”‚   â””â”€â”€ dpe_logement_202003.csv
â”‚   â””â”€â”€ derived
â”‚       â””â”€â”€ dpe_logement_merged_preprocessed.csv
â”œâ”€â”€ scripts
â”‚   â””â”€â”€ preprocessing.R
â”œâ”€â”€ analysis
â”‚   â”œâ”€â”€ generate_plots.R
â”‚   â””â”€â”€ report.Rmd
â””â”€â”€ output
    â”œâ”€â”€ histogram_energy_diagnostic.png
    â”œâ”€â”€ barplot_consumption_pcs.png
    â”œâ”€â”€ correlation_matrix.png
    â””â”€â”€ report.pdf
```

Les donnÃ©es initiales sont isolÃ©es des 
donnÃ©es retraitÃ©es dans le cadre de l'analyse. 
Le code est dÃ©composÃ© entre 
la principale chaine de traitement - sans doute Ã 
l'origine du ğŸ“ `derived/dpe_logement_merged_preprocessed.csv`
et celle qui gÃ©nÃ¨re des valorisations
ultÃ©rieures. 
En observant exclusivement l'aborescence, grÃ¢ce aux noms signifiants,
on comprend que le code traite des donnÃ©es de diagnostics Ã©nergÃ©tiques (DPE)
pour une problÃ©matique d'analyse de consommation Ã©nergÃ©tique, sans doute
en lien avec une problÃ©matique d'inÃ©gale rÃ©partition selon les PCS.


::: {.callout-conseil .icon}

Il est recommandÃ© de ne jamais utiliser d'espaces dans les noms de fichiers
ou de dossiers. Ceci peut amener Ã  des erreurs difficiles Ã  
dÃ©tecter lors de l'exÃ©cution de scripts `R`.
:::

## Documenter son projet

Le fichier `README.md`, situÃ© Ã  la racine du projet,
est Ã  la fois la carte d'identitÃ© et la vitrine du projet. En effet, comme
il s'agit du fichier qui fait office de point d'entrÃ©e
d'un projet sur `Github` ou `Gitlab`, il s'agit de la premiÃ¨re source
d'information pour comprendre l'objet du projet. 

IdÃ©alement, ce fichier contient :

- Une prÃ©sentation du contexte et des objectifs du projet;
- Une description du fonctionnement du projet (modalitÃ©s d'installation d'un package, scripts principaux...).

Dans le cadre d'un projet collaboratif, il peut Ãªtre utile d'intÃ©grer une petite
section expliquant la dÃ©marche de contribution ou renvoyer 
vers un guide de contribution plus complet si le projet est consÃ©quent. 
Pour favoriser des contributions multiples,
la documentation `utilitR`, par exemple, propose un
[guide des contributeurs](https://github.com/InseeFrLab/utilitR/blob/master/CONTRIBUTING.md)
assez dÃ©taillÃ©. 


Voici quelques modÃ¨les de `README.md` complets :

- [utilitR](https://github.com/InseeFrLab/utilitR/blob/master/README.md);
- [DoReMIFaSol](https://github.com/InseeFrLab/DoReMIFaSol).

## Ressources supplÃ©mentaires

- [eliocamp.github.io](https://eliocamp.github.io/reproducibility-with-r/materials/day1/02-projects/)

## Exercices

TO BE COMPLETED
